<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>1. Introduction to Oce • oce</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="1. Introduction to Oce">
<meta property="og:description" content="oce">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">oce</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.7-6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/A_oce.html">1. Introduction to Oce</a>
    </li>
    <li>
      <a href="../articles/B_ctd.html">2. Analysis of CTD data</a>
    </li>
    <li>
      <a href="../articles/C_adp.html">3. Analysis of acoustic-Doppler data</a>
    </li>
    <li>
      <a href="../articles/D_map_projections.html">4. Using map projections</a>
    </li>
    <li>
      <a href="../articles/E_flags.html">5. Dealing with data-quality flags</a>
    </li>
    <li>
      <a href="../articles/F_subclassing.html">6. Subclassing oce objects</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dankelley/oce/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>1. Introduction to Oce</h1>
                        <h4 data-toc-skip class="author">Dan Kelley (<a href="https://orcid.org/0000-0001-7808-5911" class="external-link uri">https://orcid.org/0000-0001-7808-5911</a>) and Clark
Richards (<a href="https://orcid.org/0000-0002-7833-206X" class="external-link uri">https://orcid.org/0000-0002-7833-206X</a>)</h4>
            
            <h4 data-toc-skip class="date">2022-06-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/dankelley/oce/blob/HEAD/vignettes/A_oce.Rmd" class="external-link"><code>vignettes/A_oce.Rmd</code></a></small>
      <div class="hidden name"><code>A_oce.Rmd</code></div>

    </div>

    
    
<!-- HOW TO BUILD AND VIEW THE OCE VIGNETTES. -->
<!-- 1. Edit this file in vignettes/oce.Rmd -->
<!-- 2. Do not bother trying to build vignettes in RStudio. Instead, ->
<!--    in a unix shell, type the following: -->
<!--        R CMD build --compact-vignettes="qpdf" oce -->
<!--        R CMD install oce_1.1-2.tar.gz -->
<!--    where the version number may need adjustment in the second command. -->
<!-- 3. To see the results, type the following in an R console: -->
<!--       browseVignettes("oce") -->
<p><strong>Abstract.</strong> The <code>oce</code> package makes it easy
to read, summarize and plot data from a variety of Oceanographic
instruments, isolating the researcher from the quirky data formats that
are common in this field. It also provides functions for working with
basic seawater properties such as the equation of state, and with
derived quantities such as the buoyancy frequency. Although simple
enough to be used in a teaching context, <code>oce</code> is powerful
enough for a research setting. These things are illustrated here in a
general context, with further detail being provided by other vignettes,
by the documentation for the package’s functions and datasets, in Kelley
(2018) and in Kelley et al. (2022).</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Oceanographers must deal with measurements made by a wide variety of
instruments, a task that is complicated by a tendency of instrument
manufacturers to invent new data formats to suite new measurement
capabilities. Many manufacturers provide software for scanning data
files and producing overview plots, but it is of somewhat limited use to
researchers who work with several instrument types at the same time, and
who need to move beyond standardized engineering plots to specialized
scientific plots and statistical analyses.</p>
</div>
<div class="section level2">
<h2 id="architecture-of-oce-objects">Architecture of oce objects<a class="anchor" aria-label="anchor" href="#architecture-of-oce-objects"></a>
</h2>
<div class="figure">
<img src="ctd-object.png" alt=""><p class="caption"><strong>Figure 1.</strong> Basic layout of a CTD
object. All <code>oce</code> objects contain slots named
<code>data</code>, <code>metadata</code>, and
<code>processingLog</code>, with the contents depending on the type of
data.</p>
</div>
<p>The need to scan diverse data files was one motivation for the
creation of <code>oce</code>, but an equal goal was to make it easy to
work with the data once they are in the system. This was accomplished
partly by the provision of specialized and generic (overloaded)
functions to work with the data, and partly by providing accessor
methods that make it convenient to reach inside the data objects (see
next section).</p>
<p>As illustrated in Figure 1, each <code>oce</code> object contains
three slots:</p>
<ul>
<li>
<code>data</code>, a list containing the actual data, e.g., for a
CTD object (see also the <a href="B_ctd.html">vignette about CTD
data</a>), this will contain <code>pressure</code>,
<code>temperature</code>, etc.</li>
<li>
<code>metadata</code>, a list containing information about the data,
such as units, data-quality flags, sampling locations, etc.</li>
<li>
<code>processingLog</code>, a list that documents how the object was
created and possibly changed thereafter.</li>
</ul>
</div>
<div class="section level2">
<h2 id="accessing-data-in-oce-objects">Accessing data in oce objects<a class="anchor" aria-label="anchor" href="#accessing-data-in-oce-objects"></a>
</h2>
<p>For detailed analysis, users may want to access data <em>within</em>
oce objects. While it is possible to descend through the object using
the “slot” and “list” notation (e.g. <code>d@data$salinity</code> yields
the salinity within an oce object named <code>d</code>), this approach
is not recommended, for two reasons. First, direct access makes a user’s
code brittle to changes in the object structure (which are sometimes
necessary to track changes in measurement technologies, or in analysis
methods). And, second, direct access is limited to what is actually
stored in the file, and this might not be what the user wants – for
example, a record might contain electrical conductivity but not
salinity.</p>
<p>The preferred approach is to use the <code>[[</code> notation, which
derives from the generic “Extract” method for accessing parts of an
object. It permits accessing not just the data stored in the object, but
also quantities that can be computed from such data (e.g. salinity, if
temperature, pressure and conductivity are stored).</p>
<p>A general introduction is provided by</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">?</span><span class="va">`[[,oce-method`</span></code></pre></div>
<p>and details are provided for individual object classes with e.g.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">?</span><span class="va">`[[,ctd-method`</span></code></pre></div>
<p>for the <code>ctd</code> class.</p>
<p>The notation is simple. For example, suppose that <code>d</code> is
an object that stores <code>salinity</code> in either its
<code>data</code> slot or <code>metadata</code> slot. Then,</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">S</span> <span class="op">&lt;-</span> <span class="va">d</span><span class="op">[[</span><span class="st">"salinity"</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<p>will extract the salinity if it is present in the object, <em>or</em>
it will compute salinity, if the object’s contents are sufficient to
compute salinity.</p>
<p>The <code>[[</code> method first looks in the <code>metadata</code>
slot, but if the item is not found there, it proceeds to look in the
<code>data</code> slot. This two-step scheme is helpful because it frees
the user from having to know where data are stored. For example, in a
<code>ctd</code> object, <code>latitude</code> might be stored in the
<code>metadata</code> (for a CTD profile) or in the <code>data</code>
slot (for the slantwise sampling of a glider).</p>
<p>The <code>[[</code> notation is helpful for several reasons, among
which two are prominent.</p>
<ol style="list-style-type: decimal">
<li><p>It can give valuable performance enhancements in some cases,
e.g. the data in the <code>landsat</code> class are stored in two
byte-level arrays, which yields a marked improvement over the 8-byte
arrays that R generally uses on a 64-bit machine. The <code>[[</code>
assembles these byte-scale chunks into a conventional R numerical
matrix, which can be quite convenient for users who wish to operate on
the data without learning how to assemble the bytes.</p></li>
<li><p>It provides a uniformity of notation that can be helpful to
users. In <code>oce</code>, objects derived from data files tend to hold
just the information in those files, not derived information. For
example, For example, CTD datasets often provide in-situ temperature but
not potential temperature (since the latter is not measured). The
in-situ temperature is found with e.g. <code>d[["temperature"]]</code>,
and so it seems natural to write <code>d[["theta"]]</code> to get the
potential temperature. If this is done, then the <code>ctd</code>
version of <code>[[</code> first looks in the data slot, and returns
<code>theta</code> if it is found there, as may sometimes be the case
(depending on the choice of the person who created the dataset).
However, if it is not found, then <code>[[</code> calls
<code><a href="../reference/swTheta.html">swTheta()</a></code> to calculate the value, and returns the
result.</p></li>
</ol>
<p>Finally, it is also possible to extract the entirety of either the
<code>metadata</code> or <code>data</code> slot, e.g.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">d</span><span class="op">[[</span><span class="st">'data'</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<p>yields the full data slot, which is a list with elements that can be
accessed in the conventional way, e.g. for a <code>ctd</code> object,
and</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span><span class="op">$</span><span class="va">temperature</span></code></pre></div>
<p>retrieves the temperature.</p>
<p>In addition to the above, <code>[[</code> has a special entry that
can reveal not just the data in the object, but also the data that can
be computed from the object. It returns a list with items named
<code>metadata</code>, <code>metadataDerived</code>, <code>data</code>
and <code>dataDerived</code>. The <code>Derived</code> items are
specific not just to the object class, but also to the data stored
within the particular object. For example,</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/" class="external-link">oce</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ctd</span><span class="op">)</span>
<span class="va">ctd</span><span class="op">[[</span><span class="st">"?"</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<p>reveals that the square of the buoyancy frequency can be retrieved
with <code>ctd[["N2"]]</code>, but if say the temperature were removed,
then <code>"N2"</code> would not have been listed.</p>
<p><strong>Exercise 1.</strong> Show that removing temperature from the
built-in <code>"ctd"</code> dataset makes <code>[["?"]]</code> indicate
that N2 is no longer available.</p>
</div>
<div class="section level2">
<h2 id="modifying-data-in-oce-objects">Modifying data in oce objects<a class="anchor" aria-label="anchor" href="#modifying-data-in-oce-objects"></a>
</h2>
<p>There are several schemes for modifying the data within
<code>oce</code> objects. For example, and by analogy with the
<code>[[</code> notation of the previous section, the following</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ctd</span><span class="op">)</span>
<span class="va">ctd</span><span class="op">[[</span><span class="st">"temperatureAboveFreezing"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">ctd</span><span class="op">[[</span><span class="st">"temperature"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="../reference/swTFreeze.html">swTFreeze</a></span><span class="op">(</span><span class="va">ctd</span><span class="op">)</span></code></pre></div>
<p>will store the excess over freezing temperature into the
<code>ctd</code> object.</p>
<p>Further information on this notation is provided by</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">?</span><span class="st">"[[&lt;-,oce-method"</span></code></pre></div>
<p>The above works only within the <code>data</code> slot. To store
within the <code>metadata</code> slot, consider using e.g.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ctd</span><span class="op">[[</span><span class="st">"metadata"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">scientist</span> <span class="op">&lt;-</span> <span class="st">"Dalhousie Oceanography 4120/5120 Class of 2003"</span></code></pre></div>
<p>sets the “scientist”.</p>
<p>For archival work, it is important to store reasons for changing
things in an object. Two functions are provided for this purpose:
<code>oceSetData</code> and <code>oceSetMetadata</code>. For example, a
better way to change the scientist might be to write</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ctd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oceSetMetadata.html">oceSetMetadata</a></span><span class="op">(</span><span class="va">ctd</span>, name<span class="op">=</span><span class="st">"scientist"</span>,
    value<span class="op">=</span><span class="st">"Dalhousie Oceanography 4120/5120 Class of 2003"</span>,
    note<span class="op">=</span><span class="st">"give credit where it's due"</span><span class="op">)</span></code></pre></div>
<p>and a better way to store <code>temperatureAboveFreezing</code> would
be</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ctd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oceSetData.html">oceSetData</a></span><span class="op">(</span><span class="va">ctd</span>, name<span class="op">=</span><span class="st">"temperatureAboveFreezing"</span>,
    value<span class="op">=</span><span class="va">ctd</span><span class="op">[[</span><span class="st">"temperature"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="../reference/swTFreeze.html">swTFreeze</a></span><span class="op">(</span><span class="va">ctd</span><span class="op">)</span>,
    unit<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>unit<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">degree</span><span class="op">*</span><span class="va">C</span><span class="op">)</span>, scale<span class="op">=</span><span class="st">"ITS-90"</span><span class="op">)</span>,
    originalName<span class="op">=</span><span class="st">"-"</span>,
    note<span class="op">=</span><span class="st">"add temperatureAboveFreezing, for ice-related calculations"</span><span class="op">)</span></code></pre></div>
<p>which illustrates that this notation, as opposed to the
<code>[[&lt;-</code> notation, permits the specification of a unit and
an <code>originalName</code>, both of which, together with the
<code>note</code>, are displayed by <code>summary(ctd)</code>.</p>
</div>
<div class="section level2">
<h2 id="oce-functions">Oce functions<a class="anchor" aria-label="anchor" href="#oce-functions"></a>
</h2>
<p>The uniformity of the various <code>oce</code> objects helps users
build skill in examining and modifying objects. Fine-scale control is
provided throughout <code>oce</code>, but the best way to learn is to
start with simplest tools and their defaults. For example, the following
will read a CTD file named <code>"station1.cnv"</code>, summarize the
contents, and plot an overview of the data, with profiles, a TS diagram,
and a map (Figure 2).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/" class="external-link">oce</a></span><span class="op">)</span>
<span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.oce.html">read.oce</a></span><span class="op">(</span><span class="st">"station1.cnv"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></code></pre></div>
<p>The reader should stop now and try this on a file of their own. The
pattern will work with a fairly wide variety of file types, because
<code><a href="../reference/read.oce.html">read.oce()</a></code> examines the file name and contents to try to
discover what it is. For an example, if <code><a href="../reference/read.oce.html">read.oce()</a></code> is given
the name of a file created by an Acoustic Doppler Profiler, it will
return an object inheriting from class <code>"adp"</code>, so the
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> and <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> calls will be tailored to
that type, e.g. the graph will show images of time-distance variation in
each of the measured velocity components.</p>
<p><strong>Notes on oce function names.</strong></p>
<ol style="list-style-type: decimal">
<li><p>As just illustrated, the general function to read a dataset ends
in <code>.oce</code>, and the name is a signal that the returned object
is of class <code>oce</code>. Depending on the file contents,
<code>d</code> will also have an additional class, e.g. if the file
contains CTD data, then the object would inherit from two classes,
<code>oce</code> and <code>ctd</code>, with the second being used to
tailor the graphics by passing control to the <code>ctd</code> variant
of the generic <code>plot</code> function (use
<code><a href="../reference/plot-ctd-method.html">help("plot,ctd-method")</a></code> to learn more).</p></li>
<li><p>Generally, <code>oce</code> functions employ a “camel case”
naming convention, in which a function that is described by several
words is named by stringing the words together, capitalizing the first
letter of second and subsequent words. For example,
<code><a href="../reference/ctdFindProfiles.html">ctdFindProfiles()</a></code> locates individual profiles within a
<code>ctd</code> object that holds data acquired during a cyclic raising
and lowering of the CTD instrument.</p></li>
<li><p>Function names begin with <code>oce</code> in cases where a more
natural name would be in conflict with a function in the base R system
or a package commonly used by Oceanographers. For example,
<code><a href="../reference/oce.contour.html">oceContour()</a></code> is a function that provides an alternative to
<code><a href="https://rdrr.io/r/graphics/contour.html" class="external-link">contour()</a></code> in the <code>graphics</code> package.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="calculation-of-seawater-properties">Calculation of seawater properties<a class="anchor" aria-label="anchor" href="#calculation-of-seawater-properties"></a>
</h2>
<p>The <code>oce</code> package provides many functions for dealing with
seawater properties. Perhaps the most used is <code>swRho(S,T,p)</code>,
which computes seawater density <span class="math inline">\(\rho=\rho(S,
T, p)\)</span>, where <span class="math inline">\(S\)</span> is
salinity, <span class="math inline">\(T\)</span> is <em>in-situ</em>
temperature in <span class="math inline">\(^\circ\)</span>C (on the
ITS-90 scale), and <span class="math inline">\(p\)</span> is seawater
pressure, i.e. the excess over atmospheric pressure, in dbar. (This and
similar functions starts with the letters <code>sw</code> to designate
that they relate to seawater properties.) The result is a number in the
order of <span class="math inline">\(1000\)</span>kg/m<span class="math inline">\(^3\)</span>. For many purposes, Oceanographers
prefer to use the density anomaly <span class="math inline">\(\sigma=\rho-1000\)</span>kg/m<span class="math inline">\(^3\)</span>, provided with
<code>swSigma(salinity,temperature,pressure)</code>, or its adiabatic
cousin <span class="math inline">\(\sigma_\theta\)</span>, provided with
<code><a href="../reference/swSigmaTheta.html">swSigmaTheta()</a></code>.</p>
<p>Most of the functions can use either the UNESCO or GSW (TEOS-10)
formulation of seawater properties, with the choice set by an argument
called <code>eos</code>. It should be noted that <code>oce</code> uses
the <code>gsw</code> package for GSW calculations.
<strong>Caution:</strong> the results obtained with
<code>eos="gsw"</code> in <code>oce</code> functions may differ from the
results obtained when using the <code>gsw</code> functions directly, due
to unit conventions. For example, <code>swCSTp(..., eos="gsw")</code>
reports conductivity ratio for consistency with the UNESCO formulation,
however the underlying <code>gsw</code> function
<code><a href="http://teos-10.github.io/GSW-R/reference/gsw_C_from_SP.html" class="external-link">gsw::gsw_C_from_SP()</a></code> reports conductivity in mS/cm.</p>
<p>A partial list of seawater functions is as follows:</p>
<ul>
<li>
<code><a href="../reference/swAlpha.html">swAlpha()</a></code> for thermal expansion coefficient <span class="math inline">\(\alpha=-\rho_0^{-1}\partial\rho/\partial
T\)</span>
</li>
<li>
<code><a href="../reference/swAlphaOverBeta.html">swAlphaOverBeta()</a></code> for <span class="math inline">\(\alpha/\beta\)</span>
</li>
<li>
<code><a href="../reference/swBeta.html">swBeta()</a></code> for haline compression coefficient <span class="math inline">\(\beta=\rho_0^{-1}\partial\rho/\partial
S\)</span>
</li>
<li>
<code>swConductivity()</code> for conductivity from <span class="math inline">\(S\)</span>, <span class="math inline">\(T\)</span>
and <span class="math inline">\(p\)</span>
</li>
<li>
<code><a href="../reference/swDepth.html">swDepth()</a></code> for depth from <span class="math inline">\(p\)</span> and latitude</li>
<li>
<code><a href="../reference/swDynamicHeight.html">swDynamicHeight()</a></code> for dynamic height</li>
<li>
<code><a href="../reference/swLapseRate.html">swLapseRate()</a></code> for adiabatic lapse rate</li>
<li>
<code><a href="../reference/swN2.html">swN2()</a></code> for buoyancy frequency</li>
<li>
<code><a href="../reference/swRho.html">swRho()</a></code> for density <span class="math inline">\(\rho\)</span> from <span class="math inline">\(S\)</span>, <span class="math inline">\(T\)</span>
and <span class="math inline">\(p\)</span>
</li>
<li>
<code><a href="../reference/swSCTp.html">swSCTp()</a></code> for salinity from conductivity, temperature
and pressure</li>
<li>
<code><a href="../reference/swSTrho.html">swSTrho()</a></code> for salinity from temperature and
density</li>
<li>
<code><a href="../reference/swSigma.html">swSigma()</a></code> for <span class="math inline">\(\rho-1000\)</span>,kg/m<span class="math inline">\(^3\)</span>
</li>
<li>
<code><a href="../reference/swSigmaT.html">swSigmaT()</a></code> for <span class="math inline">\(\sigma\)</span> with <span class="math inline">\(p\)</span> set to zero and temperature
unaltered</li>
<li>
<code><a href="../reference/swSigmaTheta.html">swSigmaTheta()</a></code> for<span class="math inline">\(\sigma\)</span> with <span class="math inline">\(p\)</span> set to zero and temperature altered
adiabatically</li>
<li>
<code><a href="../reference/swSoundSpeed.html">swSoundSpeed()</a></code> for speed of sound</li>
<li>
<code><a href="../reference/swSpecificHeat.html">swSpecificHeat()</a></code> for specific heat</li>
<li>
<code><a href="../reference/swSpice.html">swSpice()</a></code> for a quantity used in double-diffusive
research</li>
<li>
<code><a href="../reference/swTFreeze.html">swTFreeze()</a></code> for freezing temperature</li>
<li>
<code><a href="../reference/swTSrho.html">swTSrho()</a></code> for temperature from salinity and
density</li>
<li>
<code><a href="../reference/swTheta.html">swTheta()</a></code> for potential temperature <span class="math inline">\(\theta\)</span>
</li>
<li>
<code><a href="../reference/swViscosity.html">swViscosity()</a></code> for viscosity</li>
</ul>
<p>Details and examples are provided in the documentation of these
functions.</p>
<p>The following exercise may be of help to readers who prefer to learn
by doing. (Answers are provided at the end of this document.)</p>
<p><strong>Exercise 2.</strong> a. What is the density of a seawater
parcel at pressure 100 dbar, with salinity 34 PSU and temperature
10<span class="math inline">\(^\circ\)</span>C? b. What temperature
would the parcel have if raised adiabatically to the surface? c. What
density would it have if raised adiabatically to the surface? d. What
density would it have if lowered about 100m, increasing the pressure to
200 dbar? e. Draw a blank <span class="math inline">\(T\)</span>-<span class="math inline">\(S\)</span> diagram with <span class="math inline">\(S\)</span> from 30 to 40 PSU and <span class="math inline">\(T\)</span> from -2 to 20<span class="math inline">\(^\circ\)</span>C.</p>
</div>
<div class="section level2">
<h2 id="ctd-data">CTD data<a class="anchor" aria-label="anchor" href="#ctd-data"></a>
</h2>
<p>The <code>read.oce</code> function recognizes a wide variety of CTD
data formats, and the associated <code>plot</code> function can produce
many types of graphical display. In addition, there are several
functions that aid in the analysis of such data. See the <a href="B_ctd.html">ctd vignette</a> for more on dealing with CTD
data.</p>
</div>
<div class="section level2">
<h2 id="section-plots">Section plots<a class="anchor" aria-label="anchor" href="#section-plots"></a>
</h2>
<p>The commands</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">section</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">section</span>, which<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">99</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>will plot a summary diagram containing sections of <span class="math inline">\(T\)</span>, <span class="math inline">\(S\)</span>, and <span class="math inline">\(\sigma_\theta\)</span>, along with a chart
indicating station locations. In addition to such overview diagrams, the
<code>section</code> variant of the generic <code>plot</code> function
can also create individual plots of individual properties (use
<code><a href="../reference/plot-section-method.html">help("plot,section-method")</a></code> to learn more).</p>
<p>Some section datasets are supplied in a pre-gridded format, but it is
also common to have different pressure levels at each station. For such
cases, <code><a href="../reference/sectionGrid.html">sectionGrid()</a></code> may be used, e.g. the following
produces Figure 4. The ship was travelling westward from the
Mediterranean towards North America, taking 124 stations in total; the
<code>stationId</code> value selects the last few stations of the
section, during which the ship headed toward the northwest, crossing
isobaths (and perhaps, the Gulf Stream) at nearly right angles.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/" class="external-link">oce</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: gsw</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">section</span><span class="op">)</span>
<span class="va">GS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">section</span>, <span class="fl">102</span> <span class="op">&lt;=</span> <span class="va">stationId</span> <span class="op">&amp;</span> <span class="va">stationId</span> <span class="op">&lt;=</span> <span class="fl">124</span><span class="op">)</span>
<span class="va">GSg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sectionGrid.html">sectionGrid</a></span><span class="op">(</span><span class="va">GS</span>, p<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1600</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">GSg</span>, which<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">99</span><span class="op">)</span>, map.xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">85</span>,<span class="op">-</span><span class="op">(</span><span class="fl">64</span><span class="op">+</span><span class="fl">13</span><span class="op">/</span><span class="fl">60</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="A_oce_files/figure-html/unnamed-chunk-14-1.png" alt="**Figure 4.** Portion of the CTD section designated A03, showing the Gulf Sream region.  The square on the cruise track corresponds to zero distance on the section." width="288"><p class="caption">
<strong>Figure 4.</strong> Portion of the CTD section designated A03,
showing the Gulf Sream region. The square on the cruise track
corresponds to zero distance on the section.
</p>
</div>
<p><strong>Exercise 3.</strong> Draw a <span class="math inline">\(T\)</span>-<span class="math inline">\(S\)</span>
diagram for the section data, using black symbols to the east of 30W and
gray symbols to the west, thus highlighting Mediterranean-derived
waters. Use <code><a href="../reference/handleFlags.html">handleFlags()</a></code> (see <a href="E_flags.html">using
data-quality flags</a>) to discard questionable data, and use the
accessor function <code>[[</code>.</p>
<p><strong>Exercise 4.</strong> Plot dynamic height and geostrophic
velocity across the Gulf Stream. (Hint: use the
<code><a href="../reference/swDynamicHeight.html">swDynamicHeight()</a></code> function.)</p>
</div>
<div class="section level2">
<h2 id="maps">Maps<a class="anchor" aria-label="anchor" href="#maps"></a>
</h2>
<p>Oce has several functions that facilitate the drawing of maps. A
variety of projections are provided, with the mathematics of projection
being handled behind the scenes with the <code>sf</code> package. An
introduction to drawing maps is provided with <code><a href="../reference/mapPlot.html">?mapPlot</a></code>, and
the <a href="D_map_projections.html">map projection vignette</a>
provides much more detail.</p>
</div>
<div class="section level2">
<h2 id="sea-level-data">Sea-level data<a class="anchor" aria-label="anchor" href="#sea-level-data"></a>
</h2>
<p>The following code graphs a built-in dataset of sea-level time series
(Figure 9). The top panel provides an overview of the entire data set.
The second panel is narrowed to the most recent month, which should
reveal spring-neap cycles if the tide is mixed. The third panel is a log
spectrum, with a few tidal constituents indicated. The
<code>section</code> variant of the generic <code>plot</code> function
provides other possibilities for plotting, including a cumulative
spectrum that can be quite informative (use
<code><a href="../reference/plot-sealevel-method.html">help("plot,sealevel-method")</a></code> to learn more).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/" class="external-link">oce</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sealevel</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sealevel</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="A_oce_files/figure-html/unnamed-chunk-15-1.png" alt="**Figure 9.** Sea-level timeseries measured in 2003 in Halifax Harbour." width="360"><p class="caption">
<strong>Figure 9.</strong> Sea-level timeseries measured in 2003 in
Halifax Harbour.
</p>
</div>
<p><strong>Exercise 5.</strong> Illustrate Halifax sea-level variations
during Hurricane Juan, near the end of September, 2003.</p>
<p>A preliminary version of tidal analysis is provided by the
<code>tidem</code> function provided in this version of the package, but
readers are cautioned that the results are certain to change in a future
version. (The problems involve phase and the inference of satellite
nodes.)</p>
<p><strong>Exercise 6.</strong> Plot the de-tided Halifax sea level
during Autumn 2003, to see whether Hurricane Juan is visible. (Hint: use
<code>predict</code> with the results from <code>tidem</code>.)</p>
</div>
<div class="section level2">
<h2 id="acoustic-doppler-profiler-data">Acoustic Doppler Profiler data<a class="anchor" aria-label="anchor" href="#acoustic-doppler-profiler-data"></a>
</h2>
<p>The following commands produce Figure 10, showing one velocity
component of currents measured in the St Lawrence Estuary Internal Wave
Experiment. This plot type is just one of many provided by the
<code>adp</code> variant of the generic <code>plot</code> function (see
<code><a href="../reference/plot-adp-method.html">?"plot,adp-method"</a></code>). See <a href="C_adp.html">the adp
vignette</a> for much more on acoustic Doppler profiler data.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/" class="external-link">oce</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">adp</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adp</span>, which<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">adp</span><span class="op">[[</span><span class="st">'time'</span><span class="op">]</span><span class="op">]</span>, <span class="va">adp</span><span class="op">[[</span><span class="st">'pressure'</span><span class="op">]</span><span class="op">]</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="A_oce_files/figure-html/unnamed-chunk-16-1.png" alt="**Figure 10.** Measurements made with a bottom-mounted ADP in the St Lawrence Estuary. The line near the surface indicates pressure measured by the ADP." width="288"><p class="caption">
<strong>Figure 10.</strong> Measurements made with a bottom-mounted ADP
in the St Lawrence Estuary. The line near the surface indicates pressure
measured by the ADP.
</p>
</div>
</div>
<div class="section level2">
<h2 id="handling-data-quality-flags">Handling data-quality flags<a class="anchor" aria-label="anchor" href="#handling-data-quality-flags"></a>
</h2>
<p>Archives of CTD/bottle and Argo drifter measurements commonly supply
data-quality flags that provide an indication of the trust to be put in
individual data points. Oce has a flexible scheme for dealing with such
flags, and also for inserting flags into these or any data type; see the
<a href="E_flags.html">using data-quality flags vignette</a> for
more..</p>
</div>
<div class="section level2">
<h2 id="working-in-non-english-languages">Working in non-English languages<a class="anchor" aria-label="anchor" href="#working-in-non-english-languages"></a>
</h2>
<p>Many of the <code>oce</code> plotting functions produce axis labels
that can be displayed in languages other than English. At the time of
writing, French, German, Spanish, and Mandarin are supported in at least
a rudimentary way. Setting the language can be done at the general
system level, or within R, as indicated below (results not shown).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/" class="external-link">oce</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>LANGUAGE<span class="op">=</span><span class="st">"fr"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ctd</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ctd</span><span class="op">)</span></code></pre></div>
<p>Most of the translated items were found by online dictionaries, and
so they may be incorrect for oceanographic usage. Readers can help out
in the translation effort, if they have knowledge of how nautical words
such as <em>Pitch</em> and <em>Roll</em> and technical terms such as
<em>Absolute Salinity</em> and <em>Potential Temperature</em> should be
written in various languages.</p>
</div>
<div class="section level2">
<h2 id="extending-oce">Extending oce<a class="anchor" aria-label="anchor" href="#extending-oce"></a>
</h2>
<p>The oce object structure can be used as a basis for new object types.
This has the advantage the basic operations of oce will carry over to
the new types. For example, the accessing operator <code>[[</code> and
<code>summary</code> function will work as expected, and so will such
aspects as the handling of data-quality flags and units. More details on
setting up classes that inherit from oce are provided in <a href="F_subclassing.html">the subclassing vignette</a>.</p>
</div>
<div class="section level2">
<h2 id="the-future-of-oce">The future of oce<a class="anchor" aria-label="anchor" href="#the-future-of-oce"></a>
</h2>
<p>The present version of <code>oce</code> can only handle data types
that the authors have been using in their research. New data types will
be added as the need arises in that work, but the authors would also be
happy to add other data types that are likely to prove useful to the
Oceanographic community. (The data types need not be restricted to
Physical Oceanography, but the authors will need some help in dealing
with other types of data, given their research focus.)</p>
<p>Two principles will guide the addition of data types and functions:
(a) the need, as perceived by the authors or by other contributors and
(b) the ease with which the additions can be made. One might call this
development-by-triage, by analogy to the scheme used in Emergency Rooms
to organize medical effort efficiently.</p>
</div>
<div class="section level2">
<h2 id="development-website">Development website<a class="anchor" aria-label="anchor" href="#development-website"></a>
</h2>
<p>The site <code>https://github.com/dankelley/oce</code> provides a
window on the development that goes on between the CRAN releases of the
package. Readers are requested to visit the site to report bugs, to
suggest new features, or just to see how <code>oce</code> development is
coming along. Note that the <code>development</code> branch is used by
the authors in their work, and is updated so frequently that it must be
considered unstable, at least in those spots being changed on a given
day. Official CRAN releases derive from the <code>master</code> branch,
and are done when the code is considered to be of reasonable stability
and quality. This is all in a common pattern for open-source
software.</p>
</div>
<div class="section level2">
<h2 id="solutions-to-exercises">Solutions to exercises<a class="anchor" aria-label="anchor" href="#solutions-to-exercises"></a>
</h2>
<p><strong>Exercise 1.</strong> Show that removing temperature from the
built-in <code>"ctd"</code> dataset makes <code>[["?"]]</code> indicate
that N2 is no longer available.</p>
<p>This may be demonstrated as below.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/" class="external-link">oce</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ctd</span><span class="op">)</span>
<span class="st">"N2"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ctd</span><span class="op">[[</span><span class="st">"?"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">dataDerived</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="va">ctd</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">temperature</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> <span class="co"># erase temperature</span>
<span class="st">"N2"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ctd</span><span class="op">[[</span><span class="st">"?"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">dataDerived</span>
<span class="co">#&gt; [1] FALSE</span></code></pre></div>
<p><strong>Exercise 2.</strong> Seawater properties. In the UNESCO
system we may write</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/" class="external-link">oce</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/swRho.html">swRho</a></span><span class="op">(</span><span class="fl">34</span>, <span class="fl">10</span>, <span class="fl">100</span>, eos<span class="op">=</span><span class="st">"unesco"</span><span class="op">)</span>
<span class="co">#&gt; [1] 1026.624</span>
<span class="fu"><a href="../reference/swTheta.html">swTheta</a></span><span class="op">(</span><span class="fl">34</span>, <span class="fl">10</span>, <span class="fl">100</span>, eos<span class="op">=</span><span class="st">"unesco"</span><span class="op">)</span>
<span class="co">#&gt; [1] 9.988599</span>
<span class="fu"><a href="../reference/swRho.html">swRho</a></span><span class="op">(</span><span class="fl">34</span>, <span class="fu"><a href="../reference/swTheta.html">swTheta</a></span><span class="op">(</span><span class="fl">34</span>, <span class="fl">10</span>, <span class="fl">100</span>, eos<span class="op">=</span><span class="st">"unesco"</span><span class="op">)</span>, <span class="fl">0</span>, eos<span class="op">=</span><span class="st">"unesco"</span><span class="op">)</span>
<span class="co">#&gt; [1] 1026.173</span>
<span class="fu"><a href="../reference/swRho.html">swRho</a></span><span class="op">(</span><span class="fl">34</span>, <span class="fu"><a href="../reference/swTheta.html">swTheta</a></span><span class="op">(</span><span class="fl">34</span>, <span class="fl">10</span>, <span class="fl">100</span>, <span class="fl">200</span>, eos<span class="op">=</span><span class="st">"unesco"</span><span class="op">)</span>, <span class="fl">200</span>, eos<span class="op">=</span><span class="st">"unesco"</span><span class="op">)</span>
<span class="co">#&gt; [1] 1027.074</span>
<span class="fu"><a href="../reference/plotTS.html">plotTS</a></span><span class="op">(</span><span class="fu"><a href="../reference/as.ctd.html">as.ctd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>,<span class="fl">40</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>,<span class="fl">20</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>, eos<span class="op">=</span><span class="st">"unesco"</span>, grid<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></code></pre></div>
<p>and in the Gibbs SeaWater system, we use <code>eos="gws"</code> and
must supply <code>longitude</code> and <code>latitude</code> arguments
to the <code>sw*()</code> calls and also to the <code><a href="../reference/as.ctd.html">as.ctd()</a></code>
call.</p>
<p><strong>Exercise 3.</strong> Draw a <span class="math inline">\(T\)</span>-<span class="math inline">\(S\)</span>
diagram for the section data, using black symbols to the east of 30W and
gray symbols to the west, thus highlighting Mediterranean-derived
waters. Use <code><a href="../reference/handleFlags.html">handleFlags()</a></code> (see <a href="E_flags.html">using
data-quality flags</a>) to discard questionable data, and use the
accessor function <code>[[</code>.</p>
<p>We will use the Gibbs SeaWater system, so <code><a href="../reference/as.ctd.html">as.ctd()</a></code> needs
location information.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/" class="external-link">oce</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">section</span><span class="op">)</span>
<span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/handleFlags.html">handleFlags</a></span><span class="op">(</span><span class="va">section</span>, flags<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">ctd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as.ctd.html">as.ctd</a></span><span class="op">(</span><span class="va">s</span><span class="op">[[</span><span class="st">"salinity"</span><span class="op">]</span><span class="op">]</span>, <span class="va">s</span><span class="op">[[</span><span class="st">"temperature"</span><span class="op">]</span><span class="op">]</span>, <span class="va">s</span><span class="op">[[</span><span class="st">"pressure"</span><span class="op">]</span><span class="op">]</span>,
              longitude<span class="op">=</span><span class="va">s</span><span class="op">[[</span><span class="st">"longitude"</span><span class="op">]</span><span class="op">]</span>, latitude<span class="op">=</span><span class="va">s</span><span class="op">[[</span><span class="st">"latitude"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">s</span><span class="op">[[</span><span class="st">"longitude"</span><span class="op">]</span><span class="op">]</span> <span class="op">&gt;</span> <span class="op">-</span><span class="fl">30</span>, <span class="st">"black"</span>, <span class="st">"gray"</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotTS.html">plotTS</a></span><span class="op">(</span><span class="va">ctd</span>, col<span class="op">=</span><span class="va">col</span>, eos<span class="op">=</span><span class="st">"gsw"</span><span class="op">)</span></code></pre></div>
<p><strong>Exercise 4.</strong> Plot dynamic height and geostrophic
velocity across the Gulf Stream. (Hint: use the
<code>swDynamicHeight</code> function.)</p>
<p>(Try <code><a href="../reference/swDynamicHeight.html">?swDynamicHeight</a></code> for hints on smoothing.)</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/" class="external-link">oce</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">section</span><span class="op">)</span>
<span class="va">GS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">section</span>, <span class="fl">102</span> <span class="op">&lt;=</span> <span class="va">stationId</span> <span class="op">&amp;</span> <span class="va">stationId</span> <span class="op">&lt;=</span> <span class="fl">124</span><span class="op">)</span>
<span class="va">dh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/swDynamicHeight.html">swDynamicHeight</a></span><span class="op">(</span><span class="va">GS</span><span class="op">)</span>
<span class="co">#&gt; Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):</span>
<span class="co">#&gt; collapsing to unique 'x' values</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.7</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dh</span><span class="op">$</span><span class="va">distance</span>, <span class="va">dh</span><span class="op">$</span><span class="va">height</span>, type<span class="op">=</span><span class="st">"l"</span>, xlab<span class="op">=</span><span class="st">""</span>, ylab<span class="op">=</span><span class="st">"Dyn. Height [m]"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span><span class="op">)</span>
<span class="co"># 1e3 metres per kilometre</span>
<span class="va">latMean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">GS</span><span class="op">[[</span><span class="st">"latitude"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coriolis.html">coriolis</a></span><span class="op">(</span><span class="va">latMean</span><span class="op">)</span>
<span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gravity.html">gravity</a></span><span class="op">(</span><span class="va">latMean</span><span class="op">)</span>
<span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">dh</span><span class="op">$</span><span class="va">height</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">dh</span><span class="op">$</span><span class="va">distance</span><span class="op">)</span> <span class="op">*</span> <span class="va">g</span> <span class="op">/</span> <span class="va">f</span> <span class="op">/</span> <span class="fl">1e3</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dh</span><span class="op">$</span><span class="va">distance</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="va">v</span>, type<span class="op">=</span><span class="st">"l"</span>, xlab<span class="op">=</span><span class="st">"Distance [km]"</span>, ylab<span class="op">=</span><span class="st">"Velocity [m/s]"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>, col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></code></pre></div>
<p><strong>Exercise 5.</strong> Halifax sea-level during Hurricane Juan,
near the end of September, 2003.</p>
<p>A web search will tell you that Hurricane Juan hit about midnight,
2003-sep-28. The first author can verify that the strongest winds
occurred a bit after midnight – that was the time he moved to a room
without windows, in fear of flying glass.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/" class="external-link">oce</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sealevel</span><span class="op">)</span>
<span class="co"># Focus on 2003-Sep-28 to 29th, the time when Hurricane Juan caused flooding</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sealevel</span>,which<span class="op">=</span><span class="fl">1</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2003-09-24"</span>,<span class="st">"2003-10-05"</span><span class="op">)</span>, tz<span class="op">=</span><span class="st">"UTC"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2003-09-29 04:00:00"</span>, tz<span class="op">=</span><span class="st">"UTC"</span><span class="op">)</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="st">"Juan"</span>, at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2003-09-29 04:00:00"</span>, tz<span class="op">=</span><span class="st">"UTC"</span><span class="op">)</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></code></pre></div>
<p><strong>Exercise 6.</strong> Plot the de-tided Halifax sea level
during Autumn 2003, to see whether Hurricane Juan is visible. (Hint: use
<code>predict</code> with the results from <code>tidem</code>.)</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/" class="external-link">oce</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sealevel</span><span class="op">)</span>
<span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tidem.html">tidem</a></span><span class="op">(</span><span class="va">sealevel</span><span class="op">)</span>
<span class="fu"><a href="../reference/oce.plot.ts.html">oce.plot.ts</a></span><span class="op">(</span><span class="va">sealevel</span><span class="op">[[</span><span class="st">'time'</span><span class="op">]</span><span class="op">]</span>, <span class="va">sealevel</span><span class="op">[[</span><span class="st">'elevation'</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>,
    ylab<span class="op">=</span><span class="st">"Detided sealevel [m]"</span>,
    xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2003-09-20"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2003-10-08"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The spike reveals a surge of about 1.5m, on the 29th of September,
2003.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Kelley, Dan E. Oceanographic Analysis with R. 1st ed. 2018. New York,
NY: Springer New York : Imprint: Springer, 2018. <a href="https://doi.org/10.1007/978-1-4939-8844-0" class="external-link uri">https://doi.org/10.1007/978-1-4939-8844-0</a>.</p>
<p>Kelley, Dan E., Clark Richards, and Chantelle Layton. “Oce: An R
Package for Oceanographic Analysis.” Journal of Open Source Software 7,
no. 71 (March 3, 2022): 3594. <a href="https://doi.org/10.21105/joss.03594" class="external-link uri">https://doi.org/10.21105/joss.03594</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Dan Kelley, Clark Richards.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
