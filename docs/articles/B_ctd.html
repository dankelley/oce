<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>2. Analysis of CTD data • oce</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="2. Analysis of CTD data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">oce</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.8-4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/A_oce.html">1. Introduction to Oce</a></li>
    <li><a class="dropdown-item" href="../articles/B_ctd.html">2. Analysis of CTD data</a></li>
    <li><a class="dropdown-item" href="../articles/C_adp.html">3. Analysis of acoustic-Doppler data</a></li>
    <li><a class="dropdown-item" href="../articles/D_map_projections.html">4. Using map projections</a></li>
    <li><a class="dropdown-item" href="../articles/E_flags.html">5. Dealing with data-quality flags</a></li>
    <li><a class="dropdown-item" href="../articles/F_subclassing.html">6. Subclassing oce objects</a></li>
    <li><a class="dropdown-item" href="../articles/G_altering_defaults.html">7. Altering oce Defaults</a></li>
    <li><a class="dropdown-item" href="../articles/H_tides.html">8. Tidal Analysis</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dankelley/oce/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>2. Analysis of CTD data</h1>
                        <h4 data-toc-skip class="author">Dan Kelley (<a href="https://orcid.org/0000-0001-7808-5911" class="external-link uri">https://orcid.org/0000-0001-7808-5911</a>) and Clark
Richards (<a href="https://orcid.org/0000-0002-7833-206X" class="external-link uri">https://orcid.org/0000-0002-7833-206X</a>)</h4>
            
            <h4 data-toc-skip class="date">2024-12-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/dankelley/oce/blob/HEAD/vignettes/B_ctd.Rmd" class="external-link"><code>vignettes/B_ctd.Rmd</code></a></small>
      <div class="d-none name"><code>B_ctd.Rmd</code></div>
    </div>

    
    
<!-- HOW TO BUILD THE VIGNETTE. -->
<!-- 1. edit this file in vignettes/ctd.Rmd -->
<!-- 2. in an R console, use setwd() or otherwise move to the oce -->
<!--    directory, and then execute -->
<!--      devtools::build_vignettes() -->
<!-- 3. build oce. In the shell, you might use -->
<!--      cd oce ; echo "devtools::document(roclets=c('rd','collate','vignette'))" | R --no-save -->
<!--      CMD build --compact-vignettes="qpdf" oce -->
<!--      R CMD check oce_1.1-0.tar.gz -->
<!--      R CMD INSTALL oce_1.1-0.tar.gz -->
<!--    where the version number might need updating, or in an R console you might use -->
<!--      devtools::install(build_vignettes=TRUE) -->
<p><strong>Abstract.</strong> The basics of working with CTD data are
outlined in this vignette, as a supplement to a shorter entry in the <a href="A_oce.html">main vignette</a>.</p>
<div class="section level2">
<h2 id="pre-trimmed-data">Pre-trimmed data<a class="anchor" aria-label="anchor" href="#pre-trimmed-data"></a>
</h2>
<p>Many of the object types supported by <code>oce</code> come with
built-in data. For an example, <code>data(ctd)</code> yields a CTD
profile that has been trimmed to just the downcast portion of the
sampling. (See the next section to learn how to do this trimming.) A
summary and plot (Figure 2) are created as follows.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/">oce</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ctd</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ctd</span><span class="op">)</span></span>
<span><span class="co">#&gt; CTD Summary</span></span>
<span><span class="co">#&gt; -----------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; * File:                "/Users/kelley/git/oce/create_data/ctd/ctd.cnv"</span></span>
<span><span class="co">#&gt; * Instrument:          SBE 25</span></span>
<span><span class="co">#&gt; * Temp. serial no.:    1140</span></span>
<span><span class="co">#&gt; * Cond. serial no.:    832</span></span>
<span><span class="co">#&gt; * Original file:       c:\seasoft3\basin\bed0302.hex</span></span>
<span><span class="co">#&gt; * Start time:          2003-10-15 15:38:38</span></span>
<span><span class="co">#&gt; * Sample interval:     1 s</span></span>
<span><span class="co">#&gt; * Cruise:              Halifax Harbour</span></span>
<span><span class="co">#&gt; * Vessel:              Divcom3</span></span>
<span><span class="co">#&gt; * Station:             Stn 2</span></span>
<span><span class="co">#&gt; * Mean Location:       44.684N 63.644W</span></span>
<span><span class="co">#&gt; * Data Overview</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                               Min.   Mean   Max.   Dim. NAs OriginalName</span></span>
<span><span class="co">#&gt;     scan                      130    220    310    181  0   "scan"      </span></span>
<span><span class="co">#&gt;     timeS [s]                 129    219    309    181  0   "timeS"     </span></span>
<span><span class="co">#&gt;     pressure [dbar]           1.48   22.885 44.141 181  0   "pr"        </span></span>
<span><span class="co">#&gt;     depth [m]                 1.468  22.698 43.778 181  0   "depS"      </span></span>
<span><span class="co">#&gt;     temperature [°C, IPTS-68] 2.919  7.5063 14.237 181  0   "t068"      </span></span>
<span><span class="co">#&gt;     salinity [PSS-78]         29.916 31.219 31.498 181  0   "sal00"     </span></span>
<span><span class="co">#&gt;     flag                      0      0      0      181  0   "flag"      </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; * Processing Log</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     - 2018-11-14 20:03:47 UTC: `create 'ctd' object`</span></span>
<span><span class="co">#&gt;     - 2018-11-14 20:03:47 UTC: `read.ctd.sbe(file = file, debug = 10, processingLog = processingLog)`</span></span>
<span><span class="co">#&gt;     - 2018-11-14 20:03:47 UTC: `oce.edit(x = ctd, item = "startTime", value = as.POSIXct(gsub("1903",     "2003", format(ctd[["startTime"]])), tz = "UTC") + 4 * 3600,     reason = "file had year=1903, instead of 2003", person = "Dan Kelley")`</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ctd</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="B_ctd_files/figure-html/unnamed-chunk-2-1.png" alt="**Figure 2.** An overview of a ctd dataset." width="432"><p class="caption">
<strong>Figure 2.</strong> An overview of a ctd dataset.
</p>
</div>
<p>Accessing the data within this <code>ctd</code> object can be done
directly, e.g. <code>ctd@data$pressure</code> holds the pressure record,
but it is usually better to use an accessor function that is provided
with <code>oce</code>. This function is named <code>[[</code>, and it
takes a character string as an argument,
e.g. <code>ctd[["pressure"]]</code> yields the pressure column. The
accessor notation is preferable to direct access because it is simpler
for the user. For example, several <code>oce</code> objects store the
data in single-byte or two-byte chunks, to match the raw format used by
the instruments, and the accessor function takes care of translating
these values to what are sometimes called “science” units.</p>
<p><strong>Exercise 1.</strong> Plot a profile of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>θ</mi></msub><annotation encoding="application/x-tex">\sigma_\theta</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>N</mi><mn>2</mn></msup><annotation encoding="application/x-tex">N^2</annotation></semantics></math>
within the pycnocline in the built-in <code>ctd</code> data set. (Hint:
use <code><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset()</a></code>.)</p>
</div>
<div class="section level2">
<h2 id="raw-data">Raw data<a class="anchor" aria-label="anchor" href="#raw-data"></a>
</h2>
<p>Practicing Oceanographers may be wondering how the CTD cast used in
the preceding section was trimmed of equilibration-phase and
upcast-phase data. Spurious data from these phases must be trimmed as a
first step in processing. For example, consider the following code.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ctdRaw</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotScan.html">plotScan</a></span><span class="op">(</span><span class="va">ctdRaw</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="B_ctd_files/figure-html/unnamed-chunk-3-1.png" alt="**Figure 3.** Scanwise plot of the `ctdRaw` sample data set.  Note the spike at the start, the equilibration phase before the downcast, and the spurious freshening signal near the start of the upcast." width="360"><p class="caption">
<strong>Figure 3.</strong> Scanwise plot of the <code>ctdRaw</code>
sample data set. Note the spike at the start, the equilibration phase
before the downcast, and the spurious freshening signal near the start
of the upcast.
</p>
</div>
<p>This produces a two-panel plot (Figure 3) of the data as a
time-series, revealing not just the desired downcast, but also an
earlier equilibration phase and a later upcast. The x-axis in Figure 3
is the scan number, which is a convenient index for extraction of the
downcast portion of the profile by an essentially manual method,
e.g. proceeding with a sequence of commands such as</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotScan.html">plotScan</a></span><span class="op">(</span><span class="fu"><a href="../reference/ctdTrim.html">ctdTrim</a></span><span class="op">(</span><span class="va">ctdRaw</span>, <span class="st">"range"</span>,</span>
<span>    parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>item <span class="op">=</span> <span class="st">"scan"</span>, from <span class="op">=</span> <span class="fl">140</span>, to <span class="op">=</span> <span class="fl">250</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotScan.html">plotScan</a></span><span class="op">(</span><span class="fu"><a href="../reference/ctdTrim.html">ctdTrim</a></span><span class="op">(</span><span class="va">ctdRaw</span>, <span class="st">"range"</span>,</span>
<span>    parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>item <span class="op">=</span> <span class="st">"scan"</span>, from <span class="op">=</span> <span class="fl">150</span>, to <span class="op">=</span> <span class="fl">250</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This method of making decisions based on plotted information is
probably the most robust method of trimming data. However, for quick
work, users may be satisfied with the results of automatic downcast
detection, e.g.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ctdTrimmed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ctdTrim.html">ctdTrim</a></span><span class="op">(</span><span class="va">ctdRaw</span><span class="op">)</span></span></code></pre></div>
<p>It should be noted that <code><a href="../reference/ctdTrim.html">ctdTrim()</a></code> inserts entries into
the object’s log file, so that the details of how the trimming was done
are recorded together with the data.</p>
<p>Once the profile has been trimmed, one may wish to use
<code>ctd.decimate()</code> to smooth the data and interpolate the
smoothed results to uniformly-spaced pressure values.</p>
<p>Taking these things together, a quick visual examination of a CTD
file takes just one line of code:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/ctdDecimate.html">ctdDecimate</a></span><span class="op">(</span><span class="fu"><a href="../reference/ctdTrim.html">ctdTrim</a></span><span class="op">(</span><span class="fu"><a href="../reference/read.ctd.html">read.ctd</a></span><span class="op">(</span><span class="st">"stn123.cnv"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="woce-archive-data">WOCE archive data<a class="anchor" aria-label="anchor" href="#woce-archive-data"></a>
</h2>
<p>The package has a harder time scanning the headers of data files in
the WOCE archive format than it does in the Seabird format illustrated
in the previous examples. This is mainly because front-line researchers
tend to work in the Seabird format, and partly because the WOCE format
is odd. For example, the first line of a WOCE file is of the form
<code>CTD,20060609WHPOSIODAM</code> (or <code>BOTTLE,...</code>).
Scanning the item to the left of the comma is not difficult (although
there are variants to the two shown, e.g. <code>CTDO</code> sometimes
occurs). The part to the right of the comma is more difficult. The first
part is a date (<code>yyyymmdd</code>) so that is no problem. But then
things start to get tricky. In the example provided, this text contains
the division of the institute (WHPO), the institute itself (SIO), and
initial of the investigator (DAM). The problem is that no dividers
separate these items, and that there seem to be no standards for the
item lengths. Rather than spend a great deal of time coding special
cases (e.g. scanning to see if the string <code>WHOI</code> occurs in
the header line), the approach taken with <code>oce</code> is to ignore
such issues relating to quirky headers, on the assumption that users can
scan human-written headers with high skill.</p>
<p>Quite commonly, CTD profiles taken during a cruise are collected
together in a sequence of files in a given directory. For a real-world
example, one might visit the website mentioned in the code provided
below, download and expand the zip file, enter the directory thus
formed, and run the code to get an overall TS plot for all the CTD
stations of this cruise. (Caution: the link seems to change from time to
time.)</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/">oce</a></span><span class="op">)</span></span>
<span><span class="co"># http://cchdo.ucsd.edu/data/7971/ar18_58JH19941029_ct1.zip</span></span>
<span><span class="co"># setwd("~/Downloads/ar18_58JH19941029_ct1")</span></span>
<span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"*.csv$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.ctd.html">read.ctd</a></span><span class="op">(</span><span class="va">files</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="../reference/plotTS.html">plotTS</a></span><span class="op">(</span><span class="va">x</span>, Slim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">31</span>, <span class="fl">35.5</span><span class="op">)</span>, Tlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">10</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"o"</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="st">"salinity"</span><span class="op">]</span><span class="op">]</span>, <span class="va">x</span><span class="op">[[</span><span class="st">"potential temperature"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="st">"salinity"</span><span class="op">]</span><span class="op">]</span>, <span class="va">x</span><span class="op">[[</span><span class="st">"potential temperature"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The <code>[[</code> notation is explained in Section 3, but this
example conveys the gist, that it permits accessing data, or derived
data, from within an object.</p>
<p>In the above, lines connect the points within a given profile. This
can be a useful method for a quick scan looking for outliers. Another is
to colour-code the profiles, although this gets confusing with large
datasets, in which case the method of the following exercise might be
useful.</p>
<p><strong>Exercise 2. (advanced)</strong> Make a multi-file plot
summarizing the TS relationship in a collection of CTD datasets, with
each plot file showing the overall relationship in gray and the
individual profile in black.</p>
</div>
<div class="section level2">
<h2 id="solutions-to-exercises">Solutions to exercises<a class="anchor" aria-label="anchor" href="#solutions-to-exercises"></a>
</h2>
<p><strong>Exercise 1.</strong> Plot a profile of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>θ</mi></msub><annotation encoding="application/x-tex">\sigma_\theta</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>N</mi><mn>2</mn></msup><annotation encoding="application/x-tex">N^2</annotation></semantics></math>
within the pycnocline in the built-in <code>ctd</code> data set. (Hint:
use <code><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset()</a></code>.)</p>
<p>Although one may argue as to the limits of the pycnocline, for
illustration let us say it is in 5 dbar to 12 dbar range. One way to do
this is</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/">oce</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ctd</span><span class="op">)</span></span>
<span><span class="va">pycnocline</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ctdTrim.html">ctdTrim</a></span><span class="op">(</span><span class="va">ctd</span>, <span class="st">"range"</span>,</span>
<span>    parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>item <span class="op">=</span> <span class="st">"pressure"</span>, from <span class="op">=</span> <span class="fl">5</span>, to <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotProfile.html">plotProfile</a></span><span class="op">(</span><span class="va">pycnocline</span>, which <span class="op">=</span> <span class="st">"density+N2"</span><span class="op">)</span></span></code></pre></div>
<p>Another is</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/">oce</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ctd</span><span class="op">)</span></span>
<span><span class="va">pycnocline</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ctd</span>, <span class="fl">5</span> <span class="op">&lt;=</span> <span class="va">pressure</span> <span class="op">&amp;</span> <span class="va">pressure</span> <span class="op">&lt;=</span> <span class="fl">12</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotProfile.html">plotProfile</a></span><span class="op">(</span><span class="va">pycnocline</span>, which <span class="op">=</span> <span class="st">"density+N2"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Exercise 2. (advanced)</strong> Make a multi-file plot
summarizing the TS relationship in a collection of CTD datasets, with
each plot file showing the overall relationship in gray and the
individual profile in black.</p>
<p>The code provided below creates 91 PNG files, with names
<code>ar18_01.png</code>, <code>ar18_02.png</code>, etc. Loading these
in a view that permits quick paging through this file list is an easy
way to spot suspicious data, since each plot has the station number at
the top. (Users trying this example should bear in mind that this is a
fairly large dataset, so the processing will take up to a minute.)</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/">oce</a></span><span class="op">)</span></span>
<span><span class="co"># http://cchdo.ucsd.edu/data/7971/ar18_58JH19941029_ct1.zip</span></span>
<span><span class="co"># setwd("~/Downloads/ar18_58JH19941029_ct1")</span></span>
<span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"*.csv$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span></span>
<span><span class="va">ctds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="va">n</span><span class="op">)</span> <span class="co"># to hold the CTD objects</span></span>
<span><span class="va">station</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="va">n</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ctds</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.ctd.html">read.ctd</a></span><span class="op">(</span><span class="va">files</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">station</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">ctds</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"station"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="va">sal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="va">ctds</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"salinity"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="va">ctds</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"temperature"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="va">ctds</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"pressure"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">overall</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as.ctd.html">as.ctd</a></span><span class="op">(</span><span class="va">sal</span>, <span class="va">tem</span>, <span class="va">pre</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="st">"ar18_%02d.png"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/plotTS.html">plotTS</a></span><span class="op">(</span><span class="va">overall</span>, col <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">ctds</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"salinity"</span><span class="op">]</span><span class="op">]</span>, <span class="va">ctds</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"potential temperature"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="va">station</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, side <span class="op">=</span> <span class="fl">3</span>, line <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dan Kelley, Clark Richards.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
