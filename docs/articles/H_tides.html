<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>8. Tidal Analysis • oce</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="8. Tidal Analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">oce</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.8-4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/A_oce.html">1. Introduction to Oce</a></li>
    <li><a class="dropdown-item" href="../articles/B_ctd.html">2. Analysis of CTD data</a></li>
    <li><a class="dropdown-item" href="../articles/C_adp.html">3. Analysis of acoustic-Doppler data</a></li>
    <li><a class="dropdown-item" href="../articles/D_map_projections.html">4. Using map projections</a></li>
    <li><a class="dropdown-item" href="../articles/E_flags.html">5. Dealing with data-quality flags</a></li>
    <li><a class="dropdown-item" href="../articles/F_subclassing.html">6. Subclassing oce objects</a></li>
    <li><a class="dropdown-item" href="../articles/G_altering_defaults.html">7. Altering oce Defaults</a></li>
    <li><a class="dropdown-item" href="../articles/H_tides.html">8. Tidal Analysis</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dankelley/oce/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>8. Tidal Analysis</h1>
                        <h4 data-toc-skip class="author">Dan Kelley (<a href="https://orcid.org/0000-0001-7808-5911" class="external-link uri">https://orcid.org/0000-0001-7808-5911</a>) and Clark
Richards (<a href="https://orcid.org/0000-0002-7833-206X" class="external-link uri">https://orcid.org/0000-0002-7833-206X</a>)</h4>
            
            <h4 data-toc-skip class="date">2025-03-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/dankelley/oce/blob/HEAD/vignettes/H_tides.Rmd" class="external-link"><code>vignettes/H_tides.Rmd</code></a></small>
      <div class="d-none name"><code>H_tides.Rmd</code></div>
    </div>

    
    
<!-- HOW TO BUILD AND VIEW THE OCE VIGNETTES. -->
<!-- 1. Edit this file in vignettes/oce.Rmd -->
<!-- 2. Do not bother trying to build vignettes in RStudio. Instead, ->
<!--    in a unix shell, type the following: -->
<!--        R CMD build --compact-vignettes="qpdf" oce -->
<!--        R CMD install oce_1.1-2.tar.gz -->
<!--    where the version number may need adjustment in the second command. -->
<!-- 3. To see the results, type the following in an R console: -->
<!--       browseVignettes("oce") -->
<p><strong>Abstract.</strong> The <code>oce</code> package makes it easy
to analyse univariate tidal signals, like sea level. Other software
offers solutions for bivariate signals, like the horizontal components
of water velocity. This vignette touches on both cases.</p>
<p><strong>FIXME</strong> the two citations below, somewhere in this
vignette.</p>
<div class="section level2">
<h2 id="the-univariate-case-sea-level">The Univariate Case (Sea Level)<a class="anchor" aria-label="anchor" href="#the-univariate-case-sea-level"></a>
</h2>
<p>The following code graphs a built-in dataset of sea-level time
series. The top panel provides an overview of the entire data set. The
second panel is narrowed to the most recent month, which should reveal
spring-neap cycles if the tide is mixed. The third panel is a log
spectrum, with a few tidal constituents indicated. The
<code>section</code> variant of the generic <code>plot</code> function
provides other possibilities for plotting, including a cumulative
spectrum that can be quite informative (use
<code><a href="../reference/plot-sealevel-method.html">help("plot,sealevel-method")</a></code> to learn more).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/">oce</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: gsw</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sealevel</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sealevel</span><span class="op">)</span></span></code></pre></div>
<p><strong>Exercise 1.</strong> Examine Halifax sea-level variations
during Hurricane Juan, near the end of September, 2003.</p>
<p><strong>Exercise 2.</strong> Plot the de-tided Halifax sea level
during Autumn 2003, to see whether a surge associated with Hurricane
Juan is visible. (Hint: use <code>predict</code> with the results from
<code>tidem</code>.)</p>
</div>
<div class="section level2">
<h2 id="the-bivariate-case-current-components">The Bivariate Case (Current Components)<a class="anchor" aria-label="anchor" href="#the-bivariate-case-current-components"></a>
</h2>
<p>While the tidal forcing causes sea level to go up and down (according
to the prescribed constituent frequencies), the result in the ocean is
that there are also <em>currents</em> driven by the tidal variations.
Because (horizontal) currents are not a scalar (i.e. 1D) time series,
the above approach using <code><a href="../reference/tidem.html">tidem()</a></code> can only be applied by
separately considering a harmonic analysis of the “u” and “v”
(e.g. east/west and north/south) velocity components. A more common
approach for such bivariate time series, using the classical fitting
method of least squares, is to combine the horizontal velocity
components into a single complex velocity, e.g.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>u</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>i</mi><mi>v</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex"> U(t) = u(t) + i v(t) </annotation></semantics></math></p>
<p>where the results of the analysis now describe the <em>combined</em>
fit of the two related components. A common summary result from such a
fit is to describe a “tidal ellipse”, which is a horizontal ellipse that
would be traced out by each of the tidal constituents – the major and
minor axes of the ellipse describe the size of the two orthogonal
components and the phases of the u/v oscillations determine an ellipse
“orientation”, or angle.</p>
<p>Due to the use of <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code>, the <code>oce</code> package is
not able to perform a complex analysis. However, the python package <a href="https://github.com/wesleybowman/UTide" class="external-link">Utide</a> <em>can</em> do
this analysis, and thanks to the <code>reticulate</code> package in R it
is easy to run both R and python code simultaneously, while passing
variables back-and-forth between the two systems.</p>
<div class="section level3">
<h3 id="setting-up-a-python-environment-to-do-tidal-analysis">Setting up a python environment to do tidal analysis<a class="anchor" aria-label="anchor" href="#setting-up-a-python-environment-to-do-tidal-analysis"></a>
</h3>
<p>There are many different ways to set up and configure a python
environment for doing oceanography. I am not a python expert, so take
any of my advice with a grain of salt, but other competent
oceanographers that I know that use python seem to prefer the
“miniconda” distribution, which uses conda as a package manager (and can
also use the more development-oriented package repository of
conda-forge).</p>
<p>Whenever I am setting up a new miniconda install, I use the
instructions provided by the University of Hawaii Currents group, found
<a href="https://currents.soest.hawaii.edu/ocn_data_analysis/installation.html" class="external-link">here</a>.
For completeness here I’ll just repeat the steps as I have followed
them. The install is nearly identical on both MacOS and Linux. I have
not had the opportunity to try the full install on a normal Windows OS,
because even on Windows I use the Windows Subsystem for Linux (WSL) for
all my scientific coding (essentially just a terminal Ubuntu
installation embedded in Windows).</p>
<p>Copied directly from the above UH page, follow below to install the
python miniconda environment:</p>
<div class="section level4">
<h4 id="install-miniconda-base">Install Miniconda base<a class="anchor" aria-label="anchor" href="#install-miniconda-base"></a>
</h4>
<p>To begin, install the current 64-bit Python 3 <a href="https://docs.conda.io/miniconda.html" class="external-link">Miniconda</a> base that
matches your operating system. We will use the shell script version
(<code>*.sh</code>) of the installer, not a GUI version
(<code>*.pkg</code> on the Mac). We don’t even need a browser to
download the installer. Open a terminal window so you can run commands.
Then you can download the Mac installer by executing:</p>
<pre><code>curl -O https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-x86_64.sh</code></pre>
<p>if your machine has an Intel processor, or:</p>
<pre><code>curl -O https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-arm64.sh</code></pre>
<p>if you have a machine with the M1 or M2 chip (“Apple Silicon”, which
uses the ARM architecture).</p>
<div class="section level5">
<h5 id="for-linux">For Linux:<a class="anchor" aria-label="anchor" href="#for-linux"></a>
</h5>
<pre><code>curl -O https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh</code></pre>
<p>After downloading, use the bash interpreter to execute the shell
script, like this:</p>
<pre><code>bash Miniconda3-latest-MacOSX-x86_64.sh</code></pre>
<p>but substituting the corresponding file name if you are on Apple
Silicon or Linux. Do not use “sudo”; execute the script as a normal
user, and let the installation occur in the default location in your
home directory. Use the spacebar to page down through the user
agreement, hit return, and “yes” to accept it. I suggest answering “no”
to:</p>
<pre><code>Do you wish the installer to initialize Miniconda3
by running conda init? [yes|no]</code></pre>
<p>We will take care of this manually in a minute, when the installer
has finished.</p>
<p>Are you running zsh, or bash? If you are on Linux, it is almost
certainly bash. If you are on an older Mac, it might be bash. If you are
on a newer Mac, with Catalina or later, it is probably zsh. The banner
at the top of the Mac terminal window will show which one you are using.
You can also get a list of processes you are running in the terminal,
including either bash or zsh, by executing:</p>
<pre><code><span><span class="va">ps</span></span></code></pre>
<p>If it says “-bash”, ignore the hyphen; it is just bash. If you are
running zsh, then execute, on the command line:</p>
<pre><code>~/miniconda3/bin/conda init zsh</code></pre>
<p>or if you are running bash:</p>
<pre><code>~/miniconda3/bin/conda init bash</code></pre>
<p>Either way, this command will tell you that it is modifying a file,
“.zshrc” or “.zprofile” if you are running zsh, and otherwise either
“.bash_profile” or “.bashrc”. Note the name of the file being modified;
you might need it later.</p>
<p>Next, put some configuration entries in your .condarc file by cutting
and pasting the following lines into your terminal. (The backslashes are
line continuations.) You might need to hit “return” after pasting, so
the last command will be executed:</p>
<pre><code>~/miniconda3/bin/conda config --add channels conda-forge
~/miniconda3/bin/conda config --set channel_priority strict
~/miniconda3/bin/conda config --set auto_activate_base false
~/miniconda3/bin/conda config --append create_default_packages ipython \
         --append create_default_packages pip \
         --append create_default_packages "blas=*=openblas"</code></pre>
<p>(I am recommending a subset of the configuration options described in
<a href="https://gist.github.com/ocefpaf/863fc5df6ed8444378fbb1211ad8feb1" class="external-link uri">https://gist.github.com/ocefpaf/863fc5df6ed8444378fbb1211ad8feb1</a>.)</p>
<p>Now quit the terminal application completely (this is necessary with
OSX; on Linux you only need to close the terminal window and open a new
one), restart it, and check that the conda executable is found.
Execute:</p>
<pre><code>which conda</code></pre>
<p>Depending on the shell you are running, it should return either a
path that starts with your home directory followed by
miniconda3/condabin/conda (if running bash), or multiple lines of shell
code defining a conda function (if running zsh).</p>
</div>
<div class="section level5">
<h5 id="making-a-conda-environment-for-tidal-analysis">Making a conda environment for tidal analysis<a class="anchor" aria-label="anchor" href="#making-a-conda-environment-for-tidal-analysis"></a>
</h5>
<p>At this point, the next step is simply to create conda “environments”
that can be used to write/run python code. The environment approach to
containerizing workflows is somewhat foreign to the R world, but fairly
standard in python. To be honest, I like the simplicity of the R package
ecosystem, though I do see the advantages to keeping python environments
associated with projects. To create an environment that can be used for
tidal analysis, I did the following:</p>
<pre><code>conda create -n tides utide pandas</code></pre>
<p>which creates a conda environment called “tides” into which it
installs the packages “utide” and “pandas” (needed for some R to python
date conversions) and their dependencies.</p>
<p>Note that if you intend to use this environment from the command line
(e.g. by starting python, or a python IDE such as Jupyter), it is
necessary to “activate” the environment by doing:</p>
<pre><code>conda activate tides</code></pre>
<p>To use this environment in an R script, this isn’t necessary.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="using-reticulate-to-run-the-utide-python-package-in-r">Using reticulate to run the Utide python package in R<a class="anchor" aria-label="anchor" href="#using-reticulate-to-run-the-utide-python-package-in-r"></a>
</h3>
<p>Now that all the python requirements are installed, we can call the
package through R using the <code>reticulate</code> package. First, we
load the libraries and set the conda environment that we want to use for
<code>reticulate</code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/">oce</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/reticulate/" class="external-link">reticulate</a></span><span class="op">)</span></span>
<span><span class="fu">use_condaenv</span><span class="op">(</span><span class="st">"tides"</span><span class="op">)</span></span></code></pre></div>
<p>The functions associated with the python libraries can be loaded into
the R workspace with the <code>import()</code> function, like:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">utide</span> <span class="op">&lt;-</span> <span class="fu">import</span><span class="op">(</span><span class="st">"utide"</span><span class="op">)</span></span>
<span><span class="va">pandas</span> <span class="op">&lt;-</span> <span class="fu">import</span><span class="op">(</span><span class="st">"pandas"</span><span class="op">)</span></span>
<span><span class="va">np</span> <span class="op">&lt;-</span> <span class="fu">import</span><span class="op">(</span><span class="st">"numpy"</span><span class="op">)</span></span></code></pre></div>
<p>and we can load the example “tidalCurrent” dataset included in
<code>oce</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">tidalCurrent</span><span class="op">)</span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="va">tidalCurrent</span><span class="op">$</span><span class="va">time</span></span>
<span><span class="va">u</span> <span class="op">&lt;-</span> <span class="va">np</span><span class="op">$</span><span class="fu">array</span><span class="op">(</span><span class="va">tidalCurrent</span><span class="op">$</span><span class="va">u</span><span class="op">)</span></span>
<span><span class="va">v</span> <span class="op">&lt;-</span> <span class="va">np</span><span class="op">$</span><span class="fu">array</span><span class="op">(</span><span class="va">tidalCurrent</span><span class="op">$</span><span class="va">v</span><span class="op">)</span></span>
<span><span class="va">tpy</span> <span class="op">&lt;-</span> <span class="va">pandas</span><span class="op">$</span><span class="fu">to_datetime</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span>, unit <span class="op">=</span> <span class="st">"s"</span>, utc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The last line converts the R POSIX format time to a pandas
“datetime”, needed for Utide.</p>
<p>We can then perform the tidal analysis using the Utide
<code><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef()</a></code> function:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coef</span> <span class="op">&lt;-</span> <span class="va">utide</span><span class="op">$</span><span class="fu">solve</span><span class="op">(</span><span class="va">tpy</span>, <span class="va">u</span>, <span class="va">v</span>,</span>
<span>    lat <span class="op">=</span> <span class="fl">45</span>, nodal <span class="op">=</span> <span class="cn">FALSE</span>, trend <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"ols"</span>,</span>
<span>    conf_int <span class="op">=</span> <span class="st">"linear"</span>, Rayleigh_min <span class="op">=</span> <span class="fl">0.95</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## solve: matrix prep ... solution ... done.</span></span></code></pre>
<p>which produces a list <code>coef</code> that has fields:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">coef</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "aux"      "diagn"    "g"        "g_ci"     "Lsmaj"    "Lsmaj_ci"</span></span>
<span><span class="co">##  [7] "Lsmin"    "Lsmin_ci" "name"     "nI"       "nNR"      "nR"      </span></span>
<span><span class="co">## [13] "PE"       "SNR"      "theta"    "theta_ci" "umean"    "vmean"   </span></span>
<span><span class="co">## [19] "weights"</span></span></code></pre>
<p>Making a tidal prediction based on the fit, is as easy as using the
utide <code>reconstruct()</code> function:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tide</span> <span class="op">&lt;-</span> <span class="va">utide</span><span class="op">$</span><span class="fu">reconstruct</span><span class="op">(</span>t <span class="op">=</span> <span class="va">tpy</span>, coef <span class="op">=</span> <span class="va">coef</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## prep/calcs ... done.</span></span></code></pre>
<p>Let’s make some plots to show that it works!</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/oce.plot.ts.html">oce.plot.ts</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">u</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">tide</span><span class="op">[</span><span class="st">"u"</span><span class="op">]</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomleft"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"fit"</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, bg <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/oce.plot.ts.html">oce.plot.ts</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">v</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">tide</span><span class="op">[</span><span class="st">"v"</span><span class="op">]</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>We can visualize the tidal constituent ellipses, by first creating a
function that will draw an ellipse, and then looping through the
constituents from the fit and adding them to a hodograph of the
currents:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ellipse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">xc</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">yc</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">Lmaj</span>, <span class="va">Lmin</span>, <span class="va">phi</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">th</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span>, <span class="fl">0.01</span><span class="op">)</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">xc</span> <span class="op">+</span> <span class="va">Lmaj</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">th</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">phi</span><span class="op">)</span> <span class="op">-</span> <span class="va">Lmin</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">th</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">phi</span><span class="op">)</span></span>
<span>    <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">yc</span> <span class="op">+</span> <span class="va">Lmaj</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">th</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">phi</span><span class="op">)</span> <span class="op">+</span> <span class="va">Lmin</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">th</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">phi</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">u</span>, <span class="va">v</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">coef</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">ellipse</span><span class="op">(</span><span class="va">coef</span><span class="op">$</span><span class="va">umean</span>, <span class="va">coef</span><span class="op">$</span><span class="va">vmean</span>, <span class="va">coef</span><span class="op">$</span><span class="va">Lsmaj</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">coef</span><span class="op">$</span><span class="va">Lsmin</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">coef</span><span class="op">$</span><span class="va">theta</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">/</span> <span class="fl">180</span>, lwd <span class="op">=</span> <span class="fl">3</span>, col <span class="op">=</span> <span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="solutions-of-exercises">Solutions of Exercises<a class="anchor" aria-label="anchor" href="#solutions-of-exercises"></a>
</h2>
<p><strong>Solution of Exercise 1.</strong> Examine Halifax sea-level
during Hurricane Juan, near the end of September, 2003.</p>
<p>A web search will tell you that Hurricane Juan hit about midnight,
2003-sep-28. The first author can verify that the strongest winds
occurred a bit after midnight – that was the time he moved to a room
without windows, in fear of flying glass.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/">oce</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sealevel</span><span class="op">)</span></span>
<span><span class="co"># Focus on 2003-Sep-28 to 29th, the time when Hurricane Juan caused flooding</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sealevel</span>, which <span class="op">=</span> <span class="fl">1</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2003-09-24"</span>, <span class="st">"2003-10-05"</span><span class="op">)</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2003-09-29 04:00:00"</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="st">"Juan"</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2003-09-29 04:00:00"</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Solution of Exercise 2.</strong> Plot the de-tided Halifax
sea level during Autumn 2003, to see whether a surge associated with
Hurricane Juan is visible. (Hint: use <code>predict</code> with the
results from <code>tidem</code>.)</p>
<p>The following code is a simple approach. The prominent sea-level
spike on September 29th indicates the damaging storm surge that was
generated by Hurricane Juan.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/">oce</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sealevel</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tidem.html">tidem</a></span><span class="op">(</span><span class="va">sealevel</span><span class="op">)</span></span>
<span><span class="co">#&gt; Note: the tidal record is too short to fit for constituents: SA, PI1, S1, PSI1, GAM2, H1, H2, T2, R2</span></span>
<span><span class="fu"><a href="../reference/oce.plot.ts.html">oce.plot.ts</a></span><span class="op">(</span><span class="va">sealevel</span><span class="op">[[</span><span class="st">"time"</span><span class="op">]</span><span class="op">]</span>, <span class="va">sealevel</span><span class="op">[[</span><span class="st">"elevation"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"Detided sealevel [m]"</span>,</span>
<span>    xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2003-09-20"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2003-10-08"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li><p>Kelley, Dan E. Oceanographic Analysis with R. 1st ed. 2018. New
York, NY: Springer New York : Imprint: Springer, 2018. <a href="https://doi.org/10.1007/978-1-4939-8844-0" class="external-link uri">https://doi.org/10.1007/978-1-4939-8844-0</a>.</p></li>
<li><p>Kelley, Dan E., Clark Richards, and Chantelle Layton. “Oce: An R
Package for Oceanographic Analysis.” Journal of Open Source Software 7,
no. 71 (March 3, 2022): 3594. <a href="https://doi.org/10.21105/joss.03594" class="external-link uri">https://doi.org/10.21105/joss.03594</a>.</p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dan Kelley, Clark Richards.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
