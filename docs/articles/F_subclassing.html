<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>6. Subclassing oce objects • oce</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="6. Subclassing oce objects">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">oce</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.8-4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/A_oce.html">1. Introduction to Oce</a></li>
    <li><a class="dropdown-item" href="../articles/B_ctd.html">2. Analysis of CTD data</a></li>
    <li><a class="dropdown-item" href="../articles/C_adp.html">3. Analysis of acoustic-Doppler data</a></li>
    <li><a class="dropdown-item" href="../articles/D_map_projections.html">4. Using map projections</a></li>
    <li><a class="dropdown-item" href="../articles/E_flags.html">5. Dealing with data-quality flags</a></li>
    <li><a class="dropdown-item" href="../articles/F_subclassing.html">6. Subclassing oce objects</a></li>
    <li><a class="dropdown-item" href="../articles/G_altering_defaults.html">7. Altering oce Defaults</a></li>
    <li><a class="dropdown-item" href="../articles/H_tides.html">8. Tidal Analysis</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dankelley/oce/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>6. Subclassing oce objects</h1>
                        <h4 data-toc-skip class="author">Dan Kelley (<a href="https://orcid.org/0000-0001-7808-5911" class="external-link uri">https://orcid.org/0000-0001-7808-5911</a>)</h4>
            
            <h4 data-toc-skip class="date">2024-09-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/dankelley/oce/blob/HEAD/vignettes/F_subclassing.Rmd" class="external-link"><code>vignettes/F_subclassing.Rmd</code></a></small>
      <div class="d-none name"><code>F_subclassing.Rmd</code></div>
    </div>

    
    
<!-- HOW TO BUILD THE VIGNETTE. -->
<!-- Look in oce.Rmd for instructions. -->
<p><strong>Abstract.</strong> This vignette explains how to create new
object classes, using the low-level <code>oce</code> class as a
foundation. This scheme is beneficial, because the newly-formed objects
automatically gain the key properties of oce objects, in terms of
operators such as <code>[[</code> and <code>[[&lt;-</code>, functions
such as <code><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset()</a></code> and <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>, schemes for
handling units, etc. The <code><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod()</a></code> function is central to
the process of creating new classes, as will be illustrated here in a
practical way, using drifting-buoy data for example.</p>
<div class="section level2">
<h2 id="a-drifting-buoy">A drifting buoy<a class="anchor" aria-label="anchor" href="#a-drifting-buoy"></a>
</h2>
<p>Data from buoy number 4201703 were downloaded from
<code>http://www.coriolis.eu.org/Data-Products/Data-selection</code> on
2022-01-09, by deselecting all data types except for “Drifting buoy”,
selecting a data window south of Nova Scotia and of area similar to that
province, expanding the tarball created by the website and then
focussing on the downloaded file named
<code>"drifting-buoys-4201703.csv</code>“.</p>
<p>There are many data in the source data file, but only a subset is
used here: starting with 300 samples of just five of the data fields:
time (called <code>t</code> for brevity), longitude (<code>lon</code>),
latitude (<code>lat</code>), temperature (<code>Tatm</code>) and
atmospheric pressure (<code>Patm</code>). This set was further trimmed
by removing data ensembles in which temperature was not reported. The
result was 146 observations of 5 variables. (Note that they are
<em>not</em> spaced uniformly in time, a feature that is of importance
only at the end of this document.)</p>
<p>The data were combined into a data frame named <code>db</code> and
packaged in an RDA file, an overview of which is provided as
follows.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/">oce</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: gsw</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"drifter.rda"</span>, package <span class="op">=</span> <span class="st">"oce"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">db</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    146 obs. of  5 variables:</span></span>
<span><span class="co">#&gt;  $ t   : POSIXct, format: "2021-11-01 21:04:00" "2021-11-01 23:04:00" ...</span></span>
<span><span class="co">#&gt;  $ lon : num  -62.7 -62.8 -62.8 -62.8 -62.8 ...</span></span>
<span><span class="co">#&gt;  $ lat : num  42.5 42.5 42.5 42.6 42.6 ...</span></span>
<span><span class="co">#&gt;  $ Tatm: num  19.2 19.2 19.2 19.2 19.2 ...</span></span>
<span><span class="co">#&gt;  $ Patm: num  1013 1014 1015 1016 1017 ...</span></span></code></pre></div>
<p>Before showing how to create a new subclass, it will first be shown
that such data could also be stored in the foundational class of the
package.</p>
</div>
<div class="section level2">
<h2 id="using-the-base-oce-class">Using the base oce class<a class="anchor" aria-label="anchor" href="#using-the-base-oce-class"></a>
</h2>
<p>The base class is named <code>"oce"</code>, and so a new object of
that type can be created with</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/new.html" class="external-link">new</a></span><span class="op">(</span><span class="st">"oce"</span><span class="op">)</span></span></code></pre></div>
<p>At this point, the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> method does not reveal
much:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span></span>
<span><span class="co">#&gt; * Processing Log</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     - 2024-09-21 14:10:52 UTC: `Create oce object`</span></span></code></pre></div>
<p>but if we populate the object with some data and metadata</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oceSetData.html">oceSetData</a></span><span class="op">(</span><span class="va">o</span>, <span class="st">"time"</span>, <span class="va">db</span><span class="op">$</span><span class="va">t</span><span class="op">)</span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oceSetData.html">oceSetData</a></span><span class="op">(</span><span class="va">o</span>, <span class="st">"longitude"</span>, <span class="va">db</span><span class="op">$</span><span class="va">lon</span><span class="op">)</span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oceSetData.html">oceSetData</a></span><span class="op">(</span><span class="va">o</span>, <span class="st">"latitude"</span>, <span class="va">db</span><span class="op">$</span><span class="va">lat</span><span class="op">)</span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oceSetMetadata.html">oceSetMetadata</a></span><span class="op">(</span><span class="va">o</span>, <span class="st">"ID"</span>, <span class="fl">4201703</span><span class="op">)</span></span></code></pre></div>
<p>then the summary is more informative</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span></span>
<span><span class="co">#&gt; * Time: 2021-11-01 21:04:00 to 2021-11-08 06:00:00 (146 samples, mean increment 1.054713 hour)</span></span>
<span><span class="co">#&gt; * Data Overview</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;               Min.                Mean                Max.                Dim. NAs</span></span>
<span><span class="co">#&gt;     time      2021-11-01 21:04:00 2021-11-05 01:06:37 2021-11-08 06:00:00 146  0  </span></span>
<span><span class="co">#&gt;     longitude -63.011             -62.775             -62.636             146  0  </span></span>
<span><span class="co">#&gt;     latitude  41.932              42.305              42.572              146  0  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; * Processing Log</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     - 2024-09-21 14:10:52 UTC: `Create oce object`</span></span>
<span><span class="co">#&gt;     - 2024-09-21 14:10:53 UTC: `oceSetData(object = o, name = "time", value = db$t)`</span></span>
<span><span class="co">#&gt;     - 2024-09-21 14:10:53 UTC: `oceSetData(object = o, name = "longitude", value = db$lon)`</span></span>
<span><span class="co">#&gt;     - 2024-09-21 14:10:53 UTC: `oceSetData(object = o, name = "latitude", value = db$lat)`</span></span>
<span><span class="co">#&gt;     - 2024-09-21 14:10:53 UTC: `oceSetMetadata(object = o, name = "ID", value = 4201703)`</span></span></code></pre></div>
<p>Note, however, that the <code>ID</code> is not listed by
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>. This is because the general form of that
function is set up to focus on the contents of the <code>data</code>
slot, not the <code>metadata</code> slot. (Extending
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> will described later.)</p>
<p>Objects of <code>oce-class</code> automatically have other methods,
besides <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>. For example, the accessing operator
<code>[[</code> works for the object that was just created:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">o</span><span class="op">[[</span><span class="st">"latitude"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;  num [1:146] 42.5 42.5 42.5 42.6 42.6 ...</span></span></code></pre></div>
<p>We can also use the default <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function to show the
interdependence of entries in the <code>data</code> slot.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">o</span>, pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="F_subclassing_files/figure-html/unnamed-chunk-8-1.png" alt="**Figure 1.** Demonstration of base-level plot()." width="288"><p class="caption">
<strong>Figure 1.</strong> Demonstration of base-level plot().
</p>
</div>
<p>Although this plot provides a useful overview of the data, it is not
something an analyst would consider publishing. To get more useful plot
types, we must create a new subclass that has a specialized
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method.</p>
</div>
<div class="section level2">
<h2 id="creating-a-new-subclass">Creating a new subclass<a class="anchor" aria-label="anchor" href="#creating-a-new-subclass"></a>
</h2>
<p>A reasonable name for our new subclass might be
<code>"drifter"</code>. With this choice, the class can be defined in a
single line of code:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">drifter</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/methods/setClass.html" class="external-link">setClass</a></span><span class="op">(</span>Class <span class="op">=</span> <span class="st">"drifter"</span>, contains <span class="op">=</span> <span class="st">"oce"</span><span class="op">)</span></span></code></pre></div>
<p>Once this has been executed, the user can create a new object of this
subclass with</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/new.html" class="external-link">new</a></span><span class="op">(</span><span class="st">"drifter"</span><span class="op">)</span></span></code></pre></div>
<p>Although it is simple to add data and metadata as in the previous
section, it is more convenient to supply this information when
<code><a href="https://rdrr.io/r/methods/new.html" class="external-link">new()</a></code> is used. To accomplish this, we must set up an
initialization function, as follows.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span></span>
<span>    f <span class="op">=</span> <span class="st">"initialize"</span>,</span>
<span>    signature <span class="op">=</span> <span class="st">"drifter"</span>,</span>
<span>    definition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">.Object</span>, <span class="va">time</span>, <span class="va">longitude</span>, <span class="va">latitude</span>, <span class="va">ID</span> <span class="op">=</span> <span class="st">"unknown"</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html" class="external-link">missing</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"In new(drifter) : must provide 'time'"</span>, call. <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html" class="external-link">missing</a></span><span class="op">(</span><span class="va">longitude</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"In new(drifter) : must provide 'longitude'"</span>, call. <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html" class="external-link">missing</a></span><span class="op">(</span><span class="va">latitude</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"In new(drifter) : must provide 'latitude'"</span>, call. <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="va">.Object</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="va">time</span></span>
<span>        <span class="va">.Object</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">longitude</span> <span class="op">&lt;-</span> <span class="va">longitude</span></span>
<span>        <span class="va">.Object</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">latitude</span> <span class="op">&lt;-</span> <span class="va">latitude</span></span>
<span>        <span class="va">.Object</span><span class="op">@</span><span class="va">metadata</span><span class="op">$</span><span class="va">ID</span> <span class="op">&lt;-</span> <span class="va">ID</span></span>
<span>        <span class="va">.Object</span><span class="op">@</span><span class="va">processingLog</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/presentTime.html">presentTime</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="va">.Object</span><span class="op">@</span><span class="va">processingLog</span><span class="op">$</span><span class="va">value</span> <span class="op">&lt;-</span> <span class="st">"create 'drifter' object"</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">.Object</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This method takes away the choice of where to put things (in
<code>data</code> or in <code>metadata</code>), saving users from having
to make that decision, possibly breaking other code. Also, note that
some error checking has been used here, so that an attempt to use
<code>new("drifter")</code> without providing time, etc., produces an
error message, as shown below.</p>
<pre><code>d &lt;- new("drifter")
Error: In new(drifter) : must provide 'time'</code></pre>
<p>With this setup, we may now create an object that we can use for the
rest of this vignette:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/new.html" class="external-link">new</a></span><span class="op">(</span><span class="st">"drifter"</span>, time <span class="op">=</span> <span class="va">db</span><span class="op">$</span><span class="va">t</span>, longitude <span class="op">=</span> <span class="va">db</span><span class="op">$</span><span class="va">lon</span>, latitude <span class="op">=</span> <span class="va">db</span><span class="op">$</span><span class="va">lat</span>, ID <span class="op">=</span> <span class="fl">4201703</span><span class="op">)</span></span></code></pre></div>
<p>and this will be used in the next three subsections, showing how to
specialize the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method, the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>
method, and the <code>[[</code> accessor. Note the use of
<code><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod()</a></code> in each instance.</p>
<div class="section level3">
<h3 id="specializing-the-plot-function">Specializing the plot() function<a class="anchor" aria-label="anchor" href="#specializing-the-plot-function"></a>
</h3>
<p>The <code>f</code>, <code>signature</code> and
<code>definition</code> arguments follow the same pattern as in the
previous example, and readers ought to focus on last of these. Here,
three plot types are provided, as selected by an argument called
<code>which</code>. The first two give time-series plots of drifter
longitude and latitude, and the third shows the trajectory.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span></span>
<span>    f <span class="op">=</span> <span class="st">"plot"</span>,</span>
<span>    signature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/methods/GenericFunctions.html" class="external-link">signature</a></span><span class="op">(</span><span class="st">"drifter"</span><span class="op">)</span>,</span>
<span>    definition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">which</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">lonlab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Longitude ["</span> <span class="op">*</span> <span class="va">degree</span> <span class="op">*</span> <span class="st">"E]"</span><span class="op">)</span></span>
<span>        <span class="va">latlab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Latitude ["</span> <span class="op">*</span> <span class="va">degree</span> <span class="op">*</span> <span class="st">"N]"</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">which</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="fu"><a href="../reference/oce.plot.ts.html">oce.plot.ts</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="st">"time"</span><span class="op">]</span><span class="op">]</span>, <span class="va">x</span><span class="op">[[</span><span class="st">"longitude"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                ylab <span class="op">=</span> <span class="va">lonlab</span>, <span class="va">...</span></span>
<span>            <span class="op">)</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">which</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="fu"><a href="../reference/oce.plot.ts.html">oce.plot.ts</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="st">"time"</span><span class="op">]</span><span class="op">]</span>, <span class="va">x</span><span class="op">[[</span><span class="st">"latitude"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                ylab <span class="op">=</span> <span class="va">latlab</span>, <span class="va">...</span></span>
<span>            <span class="op">)</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">which</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">asp</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="st">"latitude"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">/</span> <span class="fl">180</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="st">"longitude"</span><span class="op">]</span><span class="op">]</span>, <span class="va">x</span><span class="op">[[</span><span class="st">"latitude"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                asp <span class="op">=</span> <span class="va">asp</span>, xlab <span class="op">=</span> <span class="va">lonlab</span>, ylab <span class="op">=</span> <span class="va">latlab</span>, <span class="va">...</span></span>
<span>            <span class="op">)</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"In plot,drifter-method : try which=1, 2 or 3"</span>, call. <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The three plot types are fairly rudimentary, but the <code>...</code>
argument can be used for customization, as in the following example.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3.3</span>, <span class="fl">3.3</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, mgp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.7</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/layout.html" class="external-link">layout</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">d</span>, which <span class="op">=</span> <span class="fl">1</span>, drawTimeRange <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">d</span>, which <span class="op">=</span> <span class="fl">2</span>, drawTimeRange <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">d</span>, which <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="F_subclassing_files/figure-html/unnamed-chunk-14-1.png" alt="**Figure 2.** Demonstration of specialized plot()." width="700.0000032"><p class="caption">
<strong>Figure 2.</strong> Demonstration of specialized plot().
</p>
</div>
</div>
<div class="section level3">
<h3 id="specializing-the-summary-function">Specializing the summary() function<a class="anchor" aria-label="anchor" href="#specializing-the-summary-function"></a>
</h3>
<p>Here, our sole purpose is to add an indication of the ID of the
drifter. The rest of the information provided by the base-level
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> function will suffice to summarize the rest.</p>
<p>So, with</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span></span>
<span>    f <span class="op">=</span> <span class="st">"summary"</span>,</span>
<span>    signature <span class="op">=</span> <span class="st">"drifter"</span>,</span>
<span>    definition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"CTD Summary\n-----------\n\n"</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"* ID:          "</span>, <span class="va">object</span><span class="op">[[</span><span class="st">"ID"</span><span class="op">]</span><span class="op">]</span>, <span class="st">"\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/NextMethod.html" class="external-link">callNextMethod</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>An example follows.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt; CTD Summary</span></span>
<span><span class="co">#&gt; -----------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; * ID:          4201703</span></span>
<span><span class="co">#&gt; * Time: 2021-11-01 21:04:00 to 2021-11-08 06:00:00 (146 samples, mean increment 1.054713 hour)</span></span>
<span><span class="co">#&gt; * Data Overview</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;               Min.                Mean                Max.                Dim. NAs</span></span>
<span><span class="co">#&gt;     time      2021-11-01 21:04:00 2021-11-05 01:06:37 2021-11-08 06:00:00 146  0  </span></span>
<span><span class="co">#&gt;     longitude -63.011             -62.775             -62.636             146  0  </span></span>
<span><span class="co">#&gt;     latitude  41.932              42.305              42.572              146  0  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; * Processing Log</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     - 2024-09-21 14:10:54 UTC: `create 'drifter' object`</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="specializing-the-accessor">Specializing the <code>[[</code> accessor<a class="anchor" aria-label="anchor" href="#specializing-the-accessor"></a>
</h3>
<p>The variation of drifter position provides information on ocean
velocity, and this is of sufficient interest that it might be worth
adding to <code>[[</code>. This may be done as follows.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span></span>
<span>    f <span class="op">=</span> <span class="st">"[["</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/methods/GenericFunctions.html" class="external-link">signature</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"drifter"</span>, i <span class="op">=</span> <span class="st">"ANY"</span>, j <span class="op">=</span> <span class="st">"ANY"</span><span class="op">)</span>,</span>
<span>    definition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">i</span>, <span class="va">j</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="st">"velocity"</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">D</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="va">dx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">dx</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">dx</span><span class="op">)</span></span>
<span>            <span class="op">}</span></span>
<span>            <span class="va">lat</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[[</span><span class="st">"latitude"</span><span class="op">]</span><span class="op">]</span></span>
<span>            <span class="va">lon</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[[</span><span class="st">"longitude"</span><span class="op">]</span><span class="op">]</span></span>
<span>            <span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">D</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="st">"time"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="co"># seconds</span></span>
<span>            <span class="va">scalex</span> <span class="op">&lt;-</span> <span class="fl">111.12e3</span> <span class="co"># m per degree latitude</span></span>
<span>            <span class="va">scaley</span> <span class="op">&lt;-</span> <span class="va">scalex</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">lat</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">/</span> <span class="fl">180</span><span class="op">)</span></span>
<span>            <span class="va">u</span> <span class="op">&lt;-</span> <span class="va">scalex</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">D</a></span><span class="op">(</span><span class="va">lon</span><span class="op">)</span> <span class="op">/</span> <span class="va">dt</span></span>
<span>            <span class="va">v</span> <span class="op">&lt;-</span> <span class="va">scaley</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">D</a></span><span class="op">(</span><span class="va">lat</span><span class="op">)</span> <span class="op">/</span> <span class="va">dt</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>u <span class="op">=</span> <span class="va">u</span>, v <span class="op">=</span> <span class="va">v</span><span class="op">)</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/methods/NextMethod.html" class="external-link">callNextMethod</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>As a test, we can plot the velocity components.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uv</span> <span class="op">&lt;-</span> <span class="va">d</span><span class="op">[[</span><span class="st">"velocity"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/oce.plot.ts.html">oce.plot.ts</a></span><span class="op">(</span><span class="va">d</span><span class="op">[[</span><span class="st">"time"</span><span class="op">]</span><span class="op">]</span>, <span class="va">uv</span><span class="op">$</span><span class="va">u</span>, ylab <span class="op">=</span> <span class="st">"Eastward velo. [m/s]"</span>, grid <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/oce.plot.ts.html">oce.plot.ts</a></span><span class="op">(</span><span class="va">d</span><span class="op">[[</span><span class="st">"time"</span><span class="op">]</span><span class="op">]</span>, <span class="va">uv</span><span class="op">$</span><span class="va">v</span>, ylab <span class="op">=</span> <span class="st">"Northward vel. [m/s]"</span>, grid <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="F_subclassing_files/figure-html/unnamed-chunk-18-1.png" alt="**Figure 3.** Velocities inferred from drifter motion." width="360"><p class="caption">
<strong>Figure 3.</strong> Velocities inferred from drifter motion.
</p>
</div>
<p>The <code><a href="https://rdrr.io/r/stats/acf.html" class="external-link">acf()</a></code> function, which computes lagged
autocorrelation, can shed some light on the periodicity of the velocity
signals (but see Exercise 3), as follows.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">tidedata</span><span class="op">)</span></span>
<span><span class="va">M2period</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">tidedata</span><span class="op">$</span><span class="va">const</span>, <span class="va">freq</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"M2"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">uv</span> <span class="op">&lt;-</span> <span class="va">d</span><span class="op">[[</span><span class="st">"velocity"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, mgp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.7</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/acf.html" class="external-link">acf</a></span><span class="op">(</span><span class="va">uv</span><span class="op">$</span><span class="va">u</span>, main <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">"u ACF"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">M2period</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/acf.html" class="external-link">acf</a></span><span class="op">(</span><span class="va">uv</span><span class="op">$</span><span class="va">v</span>, main <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">"v ACF"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">M2period</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="F_subclassing_files/figure-html/unnamed-chunk-19-1.png" alt="**Figure 4.** Autocorrelation analysis of drifter velocities, showing also the M2 period." width="360"><p class="caption">
<strong>Figure 4.</strong> Autocorrelation analysis of drifter
velocities, showing also the M2 period.
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>As has been illustrated above, the <code><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod()</a></code> function
is the key to altering generic functions such as <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>,
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> and <code>[[</code>. The details of how this
works are explained in numerous manuals, books, and websites, but
impatient readers can save some time by simply copying and expanding on
the code provided in the previous sections.</p>
</div>
<div class="section level2">
<h2 id="appendix-exercises-for-the-reader">Appendix: exercises for the reader<a class="anchor" aria-label="anchor" href="#appendix-exercises-for-the-reader"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Add atmospheric temperature and pressure (both contained in the
source RDA file) to the <code>drifter</code> object initialization
function. Be sure to check that they were provided or, if you choose,
let them be optional.</p></li>
<li><p>Think of other useful plot types, and add these to the
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method.</p></li>
<li><p>For the final lagged-autocorrelation function, use
<code><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approx()</a></code> to get new time-series with a constant sampling
rate.</p></li>
<li><p>Again for the lagged-autocorrelation function, add a line for
local Coriolis period.</p></li>
<li><p>As an alternative to the lagged-autocorrelation method, test for
periodicity of velocity by using <code><a href="https://rdrr.io/r/stats/nls.html" class="external-link">nls()</a></code>, supplied with a
sinusoidal function that has adjustable amplitude, phase, and
frequency.</p></li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dan Kelley, Clark Richards.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
