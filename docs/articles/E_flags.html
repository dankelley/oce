<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>5. Dealing with data-quality flags • oce</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="5. Dealing with data-quality flags">
<meta property="og:description" content="oce">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">oce</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.8-2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/A_oce.html">1. Introduction to Oce</a>
    </li>
    <li>
      <a href="../articles/B_ctd.html">2. Analysis of CTD data</a>
    </li>
    <li>
      <a href="../articles/C_adp.html">3. Analysis of acoustic-Doppler data</a>
    </li>
    <li>
      <a href="../articles/D_map_projections.html">4. Using map projections</a>
    </li>
    <li>
      <a href="../articles/E_flags.html">5. Dealing with data-quality flags</a>
    </li>
    <li>
      <a href="../articles/F_subclassing.html">6. Subclassing oce objects</a>
    </li>
    <li>
      <a href="../articles/G_altering_defaults.html">7. Altering oce Defaults</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dankelley/oce/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>5. Dealing with data-quality flags</h1>
                        <h4 data-toc-skip class="author">Dan Kelley (<a href="https://orcid.org/0000-0001-7808-5911" class="external-link uri">https://orcid.org/0000-0001-7808-5911</a>)</h4>
            
            <h4 data-toc-skip class="date">2023-10-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/dankelley/oce/blob/HEAD/vignettes/E_flags.Rmd" class="external-link"><code>vignettes/E_flags.Rmd</code></a></small>
      <div class="hidden name"><code>E_flags.Rmd</code></div>

    </div>

    
    
<!-- HOW TO BUILD THE VIGNETTE. -->
<!-- Look in oce.Rmd for instructions. -->
<p><strong>Abstract.</strong> This vignette explains the basics of
working with data-quality flags in oce. As in the vignette about working
with <a href="C_adp.html">adp data</a>, the material is organized to
reflect typical workflow. See the main oce <a href="A_oce.html">vignette</a> for general information about oce. The
sample code provided here relies on the oce package, loaded as
follows.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/" class="external-link">oce</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: gsw</span></span></code></pre></div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<div class="section level3">
<h3 id="flag-context">Flag context<a class="anchor" aria-label="anchor" href="#flag-context"></a>
</h3>
<p>It is common for oceanographers to link data with “flags” that
indicate data quality. This scheme permits retention of the original
measurements, on the assumption that they still hold some value, while
at the same time providing an indication of problems. Using flags is
superior to simply deleting suspicious data, or to changing recorded
values to <code>NA</code>, because it lets analysts try to recover from
the difficulty, perhaps by switching to another sensor, by reducing the
weights of individual data during averaging operations, etc.</p>
<p>Another advantage of using flags over simply discarding bad data is
that flags can be nuanced; e.g. distinguishing between unchecked data,
data thought to be good, data that are suspected of being bad, data that
are sure to be faulty, etc.</p>
<p>Flags are sometimes determined by automated analysis of data
(e.g. range checks on individual fields, departures from gravitational
stability, loops in TS diagrams, etc.). It is common for an analyst to
use such tests as a starting point for further processing that
incorporates the study of graphical displays, comparison with related
measurements, etc.</p>
</div>
<div class="section level3">
<h3 id="flag-conventions">Flag conventions<a class="anchor" aria-label="anchor" href="#flag-conventions"></a>
</h3>
<p>A frustrating aspect of oceanographic analysis is that different data
archiving agencies employ different systems for flags. For example, the
World Hydrographic Programme designates good bottle/CTD data with a flag
value of 2, whereas the World Ocean Database (which might be available
at
<code>https://www.ncei.noaa.gov/data/oceans/woa/WOD/CODES/TXT/Definition_of_Quality_Flags.txt</code>,
although that link failed when tested on 2021-06-26) uses 0 for good
data.</p>
<p>Analysts must be aware of the scheme used for a particular dataset.
It is also good to be on the lookout for particular values in data,
because oceanographers sometimes set suspicious values to non-physical
values that are easy to recognize, e.g. -999, -99.99, or similar, and
sometimes these coded values may contradict formal flags, when both are
present.</p>
</div>
<div class="section level3">
<h3 id="flag-storage">Flag storage<a class="anchor" aria-label="anchor" href="#flag-storage"></a>
</h3>
<p>Data-quality flags are stored in the <code>flags</code> entry in the
<code>metadata</code> slot of <code>oce</code> objects. This entry is a
list, containing items with names matching the to names of data elements
that are stored in the <code>data</code> slot. Oce functions assume that
the flags and the data are in one-to-one correspondence, so the flags
must have the same dimensionality as the data.</p>
</div>
<div class="section level3">
<h3 id="flag-inspection">Flag inspection<a class="anchor" aria-label="anchor" href="#flag-inspection"></a>
</h3>
<p>It is possible to inspect flags using e.g. to see flags corresponding
to , but a simpler notation is also provided, with e.g.  returning the
flags for the salinity data. (Note the suffix in this notation; without
that, the salinity data would be returned.)</p>
</div>
<div class="section level3">
<h3 id="flag-creation">Flag creation<a class="anchor" aria-label="anchor" href="#flag-creation"></a>
</h3>
<p>Although it is possible to set and alter flags directly, it is much
better to use oce functions to do so, because (a) they will not create
dimensionality or name conflicts with the data and (b) they record their
actions in the object’s <code>processingLog</code> slot.</p>
<p>Creating flags is usually a three-step process:</p>
<ol style="list-style-type: decimal"><li><p>Use <code>initializeFlagScheme</code> to establish a mapping
between flag numerical value and flag meaning. This step is not strictly
necessary, but it is useful because it stores the flag scheme within the
object
</p></li></ol>
</div>
</div>
</div>
</div>
</div>
</body>
</html>
