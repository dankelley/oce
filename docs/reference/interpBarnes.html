<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Grid data using Barnes algorithm — interpBarnes • oce</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Grid data using Barnes algorithm — interpBarnes" />
<meta property="og:description" content="The algorithm follows that described by Koch et al. (1983), with the
addition of the ability to blank out the grid in spots where data are
sparse, using the trim argument, and the ability to pre-grid, with
the pregrid argument." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">oce</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2-1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/oce.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/adp.html">3. Analysis of acoustic-Doppler data</a>
    </li>
    <li>
      <a href="../articles/ctd.html">2. Analysis of CTD data</a>
    </li>
    <li>
      <a href="../articles/flags.html">5. Dealing with data-quality flags</a>
    </li>
    <li>
      <a href="../articles/map_projections.html">4. Using map projections</a>
    </li>
    <li>
      <a href="../articles/subclassing.html">6. Subclassing oce objects</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/dankelley/oce/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Grid data using Barnes algorithm</h1>
    <small class="dont-index">Source: <a href='https://github.com/dankelley/oce/blob/master/R/misc.R'><code>R/misc.R</code></a></small>
    <div class="hidden name"><code>interpBarnes.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The algorithm follows that described by Koch et al. (1983), with the
addition of the ability to blank out the grid in spots where data are
sparse, using the <code>trim</code> argument, and the ability to pre-grid, with
the <code>pregrid</code> argument.</p>
    </div>

    <pre class="usage"><span class='fu'>interpBarnes</span>(
  <span class='no'>x</span>,
  <span class='no'>y</span>,
  <span class='no'>z</span>,
  <span class='no'>w</span>,
  <span class='no'>xg</span>,
  <span class='no'>yg</span>,
  <span class='no'>xgl</span>,
  <span class='no'>ygl</span>,
  <span class='no'>xr</span>,
  <span class='no'>yr</span>,
  <span class='kw'>gamma</span> <span class='kw'>=</span> <span class='fl'>0.5</span>,
  <span class='kw'>iterations</span> <span class='kw'>=</span> <span class='fl'>2</span>,
  <span class='kw'>trim</span> <span class='kw'>=</span> <span class='fl'>0</span>,
  <span class='kw'>pregrid</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>debug</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span>(<span class='st'>"oceDebug"</span>)
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x, y</th>
      <td><p>a vector of x and ylocations.</p></td>
    </tr>
    <tr>
      <th>z</th>
      <td><p>a vector of z values, one at each (x,y) location.</p></td>
    </tr>
    <tr>
      <th>w</th>
      <td><p>a optional vector of weights at the (x,y) location.  If not
supplied, then a weight of 1 is used for each point, which means equal
weighting.  Higher weights give data points more influence. If <code>pregrid</code>
is <code>TRUE</code>, then any supplied value of <code>w</code> is ignored, and instead
each of the pregriddd points is given equal weight.</p></td>
    </tr>
    <tr>
      <th>xg, yg</th>
      <td><p>optional vectors defining the x and y grids.  If not supplied,
these values are inferred from the data, using e.g. <code><a href='https://rdrr.io/r/base/pretty.html'>pretty(x, n=50)</a></code>.</p></td>
    </tr>
    <tr>
      <th>xgl, ygl</th>
      <td><p>optional lengths of the x and y grids, to be constructed with
<code><a href='https://rdrr.io/r/base/seq.html'>seq()</a></code> spanning the data range.  These values <code>xgl</code> are only
examined if <code>xg</code> and <code>yg</code> are not supplied.</p></td>
    </tr>
    <tr>
      <th>xr, yr</th>
      <td><p>optional values defining the width of the radius ellipse in the
x and y directions.  If not supplied, these are calculated as the span of x
and y over the square root of the number of data.</p></td>
    </tr>
    <tr>
      <th>gamma</th>
      <td><p>grid-focussing parameter.  At each iteration, <code>xr</code> and
<code>yr</code> are reduced by a factor of <code><a href='https://rdrr.io/r/base/MathFun.html'>sqrt(gamma)</a></code>.</p></td>
    </tr>
    <tr>
      <th>iterations</th>
      <td><p>number of iterations.</p></td>
    </tr>
    <tr>
      <th>trim</th>
      <td><p>a number between 0 and 1, indicating the quantile of data weight
to be used as a criterion for blanking out the gridded value (using
<code>NA</code>).  If 0, the whole <code>zg</code> grid is returned.  If &gt;0, any spots
on the grid where the data weight is less than the <code>trim</code>-th
<code><a href='https://rdrr.io/r/stats/quantile.html'>quantile()</a></code> are set to <code>NA</code>.  See examples.</p></td>
    </tr>
    <tr>
      <th>pregrid</th>
      <td><p>an indication of whether to pre-grid the data. If
<code>FALSE</code>, this is not done, i.e. conventional Barnes interpolation is
performed.  Otherwise, then the data are first averaged within grid cells
using <code><a href='binMean2D.html'>binMean2D()</a></code>.  If <code>pregrid</code> is <code>TRUE</code> or
<code>4</code>, then this averaging is done within a grid that is 4 times finer
than the grid that will be used for the Barnes interpolation. Otherwise,
<code>pregrid</code> may be a single integer indicating the grid refinement (4
being the result if <code>TRUE</code> had been supplied), or a vector of two
integers, for the grid refinement in x and y. The purpose of using
<code>pregrid</code> is to speed processing on large datasets, and to remove
spatial bias (e.g. with a single station that is repeated frequently in an
otherwise seldom-sampled region).  A form of pregridding is done in the
World Ocean Atlas, for example.</p></td>
    </tr>
    <tr>
      <th>debug</th>
      <td><p>a flag that turns on debugging.  Set to 0 for no debugging
information, to 1 for more, etc; the value is reduced by 1 for each
descendent function call.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list containing: <code>xg</code>, a vector holding the x-grid);
<code>yg</code>, a vector holding the y-grid; <code>zg</code>, a matrix holding the
gridded values; <code>wg</code>, a matrix holding the weights used in the
interpolation at its final iteration; and <code>zd</code>, a vector of the same
length as <code>x</code>, which holds the interpolated values at the data points.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>S. E.  Koch and M.  DesJardins and P. J. Kocin, 1983.  ``An
interactive Barnes objective map analysis scheme for use with satellite and
conventional data,'' <em>J.  Climate Appl.  Met.</em>, vol 22, p. 1487-1503.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>See <code><a href='wind.html'>wind()</a></code>.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>oce</span>)

<span class='co'># 1. contouring example, with wind-speed data from Koch et al. (1983)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>wind</span>)
<span class='no'>u</span> <span class='kw'>&lt;-</span> <span class='fu'>interpBarnes</span>(<span class='no'>wind</span>$<span class='no'>x</span>, <span class='no'>wind</span>$<span class='no'>y</span>, <span class='no'>wind</span>$<span class='no'>z</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/contour.html'>contour</a></span>(<span class='no'>u</span>$<span class='no'>xg</span>, <span class='no'>u</span>$<span class='no'>yg</span>, <span class='no'>u</span>$<span class='no'>zg</span>, <span class='kw'>labcex</span><span class='kw'>=</span><span class='fl'>1</span>)</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/text.html'>text</a></span>(<span class='no'>wind</span>$<span class='no'>x</span>, <span class='no'>wind</span>$<span class='no'>y</span>, <span class='no'>wind</span>$<span class='no'>z</span>, <span class='kw'>cex</span><span class='kw'>=</span><span class='fl'>0.7</span>, <span class='kw'>col</span><span class='kw'>=</span><span class='st'>"blue"</span>)</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/title.html'>title</a></span>(<span class='st'>"Numbers are the data"</span>)</div><div class='img'><img src='interpBarnes-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># 2. As 1, but blank out spots where data are sparse</span>
<span class='no'>u</span> <span class='kw'>&lt;-</span> <span class='fu'>interpBarnes</span>(<span class='no'>wind</span>$<span class='no'>x</span>, <span class='no'>wind</span>$<span class='no'>y</span>, <span class='no'>wind</span>$<span class='no'>z</span>, <span class='kw'>trim</span><span class='kw'>=</span><span class='fl'>0.1</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/contour.html'>contour</a></span>(<span class='no'>u</span>$<span class='no'>xg</span>, <span class='no'>u</span>$<span class='no'>yg</span>, <span class='no'>u</span>$<span class='no'>zg</span>, <span class='kw'>level</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(<span class='fl'>0</span>, <span class='fl'>30</span>, <span class='fl'>1</span>))</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/points.html'>points</a></span>(<span class='no'>wind</span>$<span class='no'>x</span>, <span class='no'>wind</span>$<span class='no'>y</span>, <span class='kw'>cex</span><span class='kw'>=</span><span class='fl'>1.5</span>, <span class='kw'>pch</span><span class='kw'>=</span><span class='fl'>20</span>, <span class='kw'>col</span><span class='kw'>=</span><span class='st'>"blue"</span>)</div><div class='img'><img src='interpBarnes-2.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># 3. As 1, but interpolate back to points, and display the percent mismatch</span>
<span class='no'>u</span> <span class='kw'>&lt;-</span> <span class='fu'>interpBarnes</span>(<span class='no'>wind</span>$<span class='no'>x</span>, <span class='no'>wind</span>$<span class='no'>y</span>, <span class='no'>wind</span>$<span class='no'>z</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/contour.html'>contour</a></span>(<span class='no'>u</span>$<span class='no'>xg</span>, <span class='no'>u</span>$<span class='no'>yg</span>, <span class='no'>u</span>$<span class='no'>zg</span>, <span class='kw'>labcex</span><span class='kw'>=</span><span class='fl'>1</span>)</div><div class='input'><span class='no'>mismatch</span> <span class='kw'>&lt;-</span> <span class='fl'>100</span> * (<span class='no'>wind</span>$<span class='no'>z</span> - <span class='no'>u</span>$<span class='no'>zd</span>) / <span class='no'>wind</span>$<span class='no'>z</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/text.html'>text</a></span>(<span class='no'>wind</span>$<span class='no'>x</span>, <span class='no'>wind</span>$<span class='no'>y</span>, <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span>(<span class='no'>mismatch</span>), <span class='kw'>col</span><span class='kw'>=</span><span class='st'>"blue"</span>)</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/title.html'>title</a></span>(<span class='st'>"Numbers are percent mismatch between grid and data"</span>)</div><div class='img'><img src='interpBarnes-3.png' alt='' width='700' height='433' /></div><div class='input'>

<span class='co'># 4. As 3, but contour the mismatch</span>
<span class='no'>mismatchGrid</span> <span class='kw'>&lt;-</span> <span class='fu'>interpBarnes</span>(<span class='no'>wind</span>$<span class='no'>x</span>, <span class='no'>wind</span>$<span class='no'>y</span>, <span class='no'>mismatch</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/contour.html'>contour</a></span>(<span class='no'>mismatchGrid</span>$<span class='no'>xg</span>, <span class='no'>mismatchGrid</span>$<span class='no'>yg</span>, <span class='no'>mismatchGrid</span>$<span class='no'>zg</span>, <span class='kw'>labcex</span><span class='kw'>=</span><span class='fl'>1</span>)</div><div class='img'><img src='interpBarnes-4.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># 5. One-dimensional example, smoothing a salinity profile</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>ctd</span>)
<span class='no'>p</span> <span class='kw'>&lt;-</span> <span class='no'>ctd</span><span class='kw'>[[</span><span class='st'>"pressure"</span>]]
<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>p</span>)) <span class='co'># fake y data, with arbitrary value</span>
<span class='no'>S</span> <span class='kw'>&lt;-</span> <span class='no'>ctd</span><span class='kw'>[[</span><span class='st'>"salinity"</span>]]
<span class='no'>pg</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/pretty.html'>pretty</a></span>(<span class='no'>p</span>, <span class='kw'>n</span><span class='kw'>=</span><span class='fl'>100</span>)
<span class='no'>g</span> <span class='kw'>&lt;-</span> <span class='fu'>interpBarnes</span>(<span class='no'>p</span>, <span class='no'>y</span>, <span class='no'>S</span>, <span class='kw'>xg</span><span class='kw'>=</span><span class='no'>pg</span>, <span class='kw'>xr</span><span class='kw'>=</span><span class='fl'>1</span>)
<span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>S</span>, <span class='no'>p</span>, <span class='kw'>cex</span><span class='kw'>=</span><span class='fl'>0.5</span>, <span class='kw'>col</span><span class='kw'>=</span><span class='st'>"blue"</span>, <span class='kw'>ylim</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/rev.html'>rev</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/range.html'>range</a></span>(<span class='no'>p</span>)))</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span>(<span class='no'>g</span>$<span class='no'>zg</span>, <span class='no'>g</span>$<span class='no'>xg</span>, <span class='kw'>col</span><span class='kw'>=</span><span class='st'>"red"</span>)</div><div class='img'><img src='interpBarnes-5.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Dan Kelley, Clark Richards.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


