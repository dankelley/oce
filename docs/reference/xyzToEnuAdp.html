<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Convert ADP From XYZ to ENU Coordinates — xyzToEnuAdp • oce</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Convert ADP From XYZ to ENU Coordinates — xyzToEnuAdp"><meta property="og:description" content="Convert ADP velocity components from a xyz-based coordinate system to
an enu-based coordinate system, by using the instrument's recording of
information relating to heading, pitch, and roll. The action is based
on what is stored in the data, and so it depends greatly on instrument type
and the style of original data format. This function handles data from
RDI Teledyne, Sontek, and some Nortek instruments directly."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">oce</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.8-2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/A_oce.html">1. Introduction to Oce</a>
    </li>
    <li>
      <a href="../articles/B_ctd.html">2. Analysis of CTD data</a>
    </li>
    <li>
      <a href="../articles/C_adp.html">3. Analysis of acoustic-Doppler data</a>
    </li>
    <li>
      <a href="../articles/D_map_projections.html">4. Using map projections</a>
    </li>
    <li>
      <a href="../articles/E_flags.html">5. Dealing with data-quality flags</a>
    </li>
    <li>
      <a href="../articles/F_subclassing.html">6. Subclassing oce objects</a>
    </li>
    <li>
      <a href="../articles/G_altering_defaults.html">7. Altering oce Defaults</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/dankelley/oce/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Convert ADP From XYZ to ENU Coordinates</h1>
    <small class="dont-index">Source: <a href="https://github.com/dankelley/oce/blob/HEAD/R/adp.R" class="external-link"><code>R/adp.R</code></a></small>
    <div class="hidden name"><code>xyzToEnuAdp.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Convert ADP velocity components from a xyz-based coordinate system to
an enu-based coordinate system, by using the instrument's recording of
information relating to heading, pitch, and roll. The action is based
on what is stored in the data, and so it depends greatly on instrument type
and the style of original data format. This function handles data from
RDI Teledyne, Sontek, and some Nortek instruments directly.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">xyzToEnuAdp</span><span class="op">(</span><span class="va">x</span>, declination <span class="op">=</span> <span class="fl">0</span>, debug <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"oceDebug"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>an <a href="adp-class.html">adp</a> object.</p></dd>


<dt>declination</dt>
<dd><p>magnetic declination to be added to the heading after
"righting" (see below), to get ENU with N as "true" north.  If this
is set to NULL, then the returned object is set up without adjusting
the compass for declination.  That means that <code>north</code> in its <code>metadata</code>
slot will be set to <code>"magnetic"</code>, and also that there will be no item
named <code>declination</code> in that slot.  Note that <code><a href="applyMagneticDeclination.html">applyMagneticDeclination()</a></code>
can be used later, to set a declination.</p></dd>


<dt>debug</dt>
<dd><p>an integer specifying whether debugging information is
to be printed during the processing. This is a general parameter that
is used by many <code>oce</code> functions. Generally, setting <code>debug=0</code>
turns off the printing, while higher values suggest that more information
be printed. If one function calls another, it usually reduces the value of
<code>debug</code> first, so that a user can often obtain deeper debugging
by specifying higher <code>debug</code> values.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>An object with <code>data$v[,,1:3]</code> altered appropriately, and
<code>x[["oceCoordinate"]]</code> changed from <code>xyz</code> to <code>enu</code>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The first step is to convert the (x,y,z) velocity components (stored in the
three columns of <code>x[["v"]][,,1:3]</code>) into what RDI (reference 1, pages 11 and 12)
calls "ship" (or "righted") components.  For example, the z coordinate,
which may point upwards or downwards depending on instrument orientation, is
mapped onto a "mast" coordinate that points more nearly upwards than
downward.  The other ship coordinates are called "starboard" and "forward",
the meanings of which will be clear to mariners.  Once the (x,y,z)
velocities are converted to ship velocities, the orientation of the
instrument is extracted from heading, pitch, and roll vectors stored in the
object.  These angles are defined differently for RDI and Sontek profilers.</p>
<p>The code handles every case individually, based on the table given below.
The table comes from Clark Richards, a former PhD student at Dalhousie
University (reference 2), who developed it based on instrument documentation,
discussion on user groups, and analysis of measurements acquired with RDI
and Sontek acoustic current profilers in the SLEIWEX experiment.  In the
table, (X, Y, Z) denote instrument-coordinate velocities, (S, F, M) denote
ship-coordinate velocities, and (H, P, R) denote heading, pitch, and roll.</p>
<table class="table table"><tr><td><strong>Case</strong></td><td><strong>Mfr.</strong></td><td><strong>Instr.</strong> <strong>Orient.</strong></td><td><strong>H</strong></td><td><strong>P</strong></td><td><strong>R</strong></td><td><strong>S</strong></td><td><strong>F</strong></td><td><strong>M</strong></td><td>1</td><td>RDI</td><td>ADCP</td></tr><tr><td>up</td><td>H</td><td>arctan(tan(P)*cos(R))</td><td>R</td><td>-X</td><td>Y</td><td>-Z</td><td>2</td><td>RDI</td><td>ADCP</td><td>down</td><td>H</td></tr><tr><td>arctan(tan(P)*cos(R))</td><td>-R</td><td>X</td><td>Y</td><td>Z</td><td>3</td><td>Nortek</td><td>ADP</td><td>up</td><td>H-90</td><td>R</td><td>-P</td></tr><tr><td>X</td><td>Y</td><td>Z</td><td>4</td><td>Nortek</td><td>ADP</td><td>down</td><td>H-90</td><td>R</td><td>-P</td><td>X</td><td>-Y</td></tr><tr><td>-Z</td><td>5</td><td>Sontek</td><td>ADP</td><td>up</td><td>H-90</td><td>-P</td><td>-R</td><td>X</td><td>Y</td><td>Z</td><td>6</td></tr><tr><td>Sontek</td><td>ADP</td><td>down</td><td>H-90</td><td>-P</td><td>-R</td><td>X</td><td>Y</td><td>Z</td><td>7</td><td>Sontek</td><td>PCADP</td></tr><tr><td>up</td><td>H-90</td><td>R</td><td>-P</td><td>X</td><td>Y</td><td>Z</td><td>8</td><td>Sontek</td><td>PCADP</td><td>down</td><td>H-90</td></tr></table><p>Finally, a standardized rotation matrix is used to convert from ship
coordinates to earth coordinates.  As described in the RDI coordinate
transformation manual (reference 1, pages 13 and 14), this matrix is based on sines
and cosines of heading, pitch, and roll If <code>CH</code> and <code>SH</code> denote
cosine and sine of heading (after adjusting for declination), with similar
terms for pitch and roll using second letters <code>P</code> and <code>R</code>, the
rotation matrix is</p>
<div class="sourceCode"><pre><code><span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="va">CH</span><span class="op">*</span><span class="va">CR</span> <span class="op">+</span> <span class="va">SH</span><span class="op">*</span><span class="va">SP</span><span class="op">*</span><span class="va">SR</span>, <span class="va">SH</span><span class="op">*</span><span class="va">CP</span>, <span class="va">CH</span><span class="op">*</span><span class="va">SR</span> <span class="op">-</span> <span class="va">SH</span><span class="op">*</span><span class="va">SP</span><span class="op">*</span><span class="va">CR</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="va">SH</span><span class="op">*</span><span class="va">CR</span></span>
<span><span class="op">+</span> <span class="va">CH</span><span class="op">*</span><span class="va">SP</span><span class="op">*</span><span class="va">SR</span>, <span class="va">CH</span><span class="op">*</span><span class="va">CP</span>, <span class="op">-</span><span class="va">SH</span><span class="op">*</span><span class="va">SR</span> <span class="op">-</span> <span class="va">CH</span><span class="op">*</span><span class="va">SP</span><span class="op">*</span><span class="va">CR</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="op">-</span><span class="va">CP</span><span class="op">*</span><span class="va">SR</span>, <span class="va">SP</span>, <span class="va">CP</span><span class="op">*</span><span class="va">CR</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>

<p>This matrix is left-multiplied by a matrix with three rows, the top a vector
of "starboard" values, the middle a vector of "forward" values, and the
bottom a vector of "mast" values.  Finally, the columns of
<code>data$v[,,1:3]</code> are filled in with the result of the matrix
multiplication.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    
<ol><li><p>Teledyne RD Instruments. “ADCP Coordinate Transformation: Formulas and Calculations,”
January 2010. P/N 951-6079-00.</p></li>
<li><p>Clark Richards, 2012, PhD Dalhousie University Department of
Oceanography.</p></li>
</ol></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other things related to adp data: 
<code><a href="sub-sub-adp-method.html">[[,adp-method</a></code>,
<code>[[&lt;-,adp-method</code>,
<code><a href="ad2cpCodeToName.html">ad2cpCodeToName</a>()</code>,
<code><a href="ad2cpHeaderValue.html">ad2cpHeaderValue</a>()</code>,
<code><a href="adp-class.html">adp-class</a></code>,
<code><a href="adpAd2cpFileTrim.html">adpAd2cpFileTrim</a>()</code>,
<code><a href="adpConvertRawToNumeric.html">adpConvertRawToNumeric</a>()</code>,
<code><a href="adpEnsembleAverage.html">adpEnsembleAverage</a>()</code>,
<code><a href="adpFlagPastBoundary.html">adpFlagPastBoundary</a>()</code>,
<code><a href="adpRdiFileTrim.html">adpRdiFileTrim</a>()</code>,
<code><a href="adp_rdi.000.html">adp_rdi.000</a></code>,
<code><a href="adp.html">adp</a></code>,
<code><a href="applyMagneticDeclination-adp-method.html">applyMagneticDeclination,adp-method</a></code>,
<code><a href="as.adp.html">as.adp</a>()</code>,
<code><a href="beamName.html">beamName</a>()</code>,
<code><a href="beamToXyzAdpAD2CP.html">beamToXyzAdpAD2CP</a>()</code>,
<code><a href="beamToXyzAdp.html">beamToXyzAdp</a>()</code>,
<code><a href="beamToXyzAdv.html">beamToXyzAdv</a>()</code>,
<code><a href="beamToXyz.html">beamToXyz</a>()</code>,
<code><a href="beamUnspreadAdp.html">beamUnspreadAdp</a>()</code>,
<code><a href="binmapAdp.html">binmapAdp</a>()</code>,
<code><a href="enuToOtherAdp.html">enuToOtherAdp</a>()</code>,
<code><a href="enuToOther.html">enuToOther</a>()</code>,
<code><a href="handleFlags-adp-method.html">handleFlags,adp-method</a></code>,
<code><a href="is.ad2cp.html">is.ad2cp</a>()</code>,
<code><a href="plot-adp-method.html">plot,adp-method</a></code>,
<code><a href="read.adp.ad2cp.html">read.adp.ad2cp</a>()</code>,
<code><a href="read.adp.nortek.html">read.adp.nortek</a>()</code>,
<code><a href="read.adp.rdi.html">read.adp.rdi</a>()</code>,
<code><a href="read.adp.sontek.serial.html">read.adp.sontek.serial</a>()</code>,
<code><a href="read.adp.sontek.html">read.adp.sontek</a>()</code>,
<code><a href="read.adp.html">read.adp</a>()</code>,
<code><a href="read.aquadoppHR.html">read.aquadoppHR</a>()</code>,
<code><a href="read.aquadoppProfiler.html">read.aquadoppProfiler</a>()</code>,
<code><a href="read.aquadopp.html">read.aquadopp</a>()</code>,
<code><a href="rotateAboutZ.html">rotateAboutZ</a>()</code>,
<code><a href="setFlags-adp-method.html">setFlags,adp-method</a></code>,
<code><a href="subset-adp-method.html">subset,adp-method</a></code>,
<code><a href="subtractBottomVelocity.html">subtractBottomVelocity</a>()</code>,
<code><a href="summary-adp-method.html">summary,adp-method</a></code>,
<code><a href="toEnuAdp.html">toEnuAdp</a>()</code>,
<code><a href="toEnu.html">toEnu</a>()</code>,
<code><a href="velocityStatistics.html">velocityStatistics</a>()</code>,
<code><a href="xyzToEnuAdpAD2CP.html">xyzToEnuAdpAD2CP</a>()</code>,
<code><a href="xyzToEnu.html">xyzToEnu</a>()</code></p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Dan Kelley and Clark Richards</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Dan Kelley, Clark Richards.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

