<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Smooth a Section — sectionSmooth • oce</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Smooth a Section — sectionSmooth"><meta property="og:description" content="Smooth a section, in any of several ways, working either in the vertical
direction or in both the vertical and lateral directions."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">oce</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.8-2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/A_oce.html">1. Introduction to Oce</a>
    </li>
    <li>
      <a href="../articles/B_ctd.html">2. Analysis of CTD data</a>
    </li>
    <li>
      <a href="../articles/C_adp.html">3. Analysis of acoustic-Doppler data</a>
    </li>
    <li>
      <a href="../articles/D_map_projections.html">4. Using map projections</a>
    </li>
    <li>
      <a href="../articles/E_flags.html">5. Dealing with data-quality flags</a>
    </li>
    <li>
      <a href="../articles/F_subclassing.html">6. Subclassing oce objects</a>
    </li>
    <li>
      <a href="../articles/G_altering_defaults.html">7. Altering oce Defaults</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/dankelley/oce/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Smooth a Section</h1>
    <small class="dont-index">Source: <a href="https://github.com/dankelley/oce/blob/HEAD/R/section.R" class="external-link"><code>R/section.R</code></a></small>
    <div class="hidden name"><code>sectionSmooth.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Smooth a section, in any of several ways, working either in the vertical
direction or in both the vertical and lateral directions.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sectionSmooth</span><span class="op">(</span></span>
<span>  <span class="va">section</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"spline"</span>,</span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">xg</span>,</span>
<span>  <span class="va">yg</span>,</span>
<span>  <span class="va">xgl</span>,</span>
<span>  <span class="va">ygl</span>,</span>
<span>  <span class="va">xr</span>,</span>
<span>  <span class="va">yr</span>,</span>
<span>  <span class="va">df</span>,</span>
<span>  gamma <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  iterations <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  trim <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  pregrid <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  debug <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"oceDebug"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>section</dt>
<dd><p>A <code>section</code> object containing the section to be smoothed.
For <code>method="spline"</code>, the pressure levels must match for each station in
the section.</p></dd>


<dt>method</dt>
<dd><p>A string or a function that specifies the method to use; see “Details”.</p></dd>


<dt>x</dt>
<dd><p>Optional numerical vector, of the same length as the number of stations in <code>section</code>,
which will be used in gridding in the lateral direction. If not provided, this
defaults to <code><a href="geodDist.html">geodDist</a></code><code>(section)</code>.</p></dd>


<dt>xg, xgl</dt>
<dd><p>ignored in the <code>method="spline"</code> case, but passed to
<code><a href="interpBarnes.html">interpBarnes()</a></code> if <code>method="barnes"</code>, to kriging
functions if <code>method="kriging"</code>, or to <code>method</code> itself, if it
is a function.
If <code>xg</code> is supplied, it defines the x component of the grid, which by
default is the terms of station distances, x, along the track of the section. (Note
that the grid <code>xg</code> is trimmed to the range of the data <code>x</code>, because otherwise
it would be impossible to interpolate between stations to infer water depth,
longitude, and latitude, which are all stored within the stations in the
returned <code>section</code> object.)
Alternatively, if <code>xgl</code> is supplied, the x grid is established using <code><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq()</a></code>,
to span the data with <code>xgl</code> elements. If neither of these is supplied, the output
x grid will equal the input x grid.</p></dd>


<dt>yg, ygl</dt>
<dd><p>similar to <code>xg</code> and <code>xgl</code>, but for pressure. (Note that
trimming to the input <code>y</code> is not done, as it is for <code>xg</code> and <code>x</code>.)
If <code>yg</code> is not given, it is determined from the deepest station in the section.
If <code>ygl</code> was not given, then a grid is constructed to span the pressures
of that deepest station with <code>ygl</code> elements. On the other hand,
if <code>ygl</code> was not given, then the y grid will constructed from the
pressure levels in the deepest station.</p></dd>


<dt>xr, yr</dt>
<dd><p>influence ranges in x (along-section distance) and y (pressure),
passed to <code><a href="interpBarnes.html">interpBarnes()</a></code> if <code>method="barnes"</code> or to
<code>method</code>, if the latter is a function. If missing, <code>xr</code> defaults to
1.5X the median inter-station distance and <code>yr</code> defaults to 0.2X
the pressure range. Since these defaults have changed over the evolution
of <code>sectionSmooth</code>, analysts ought to supply <code>xr</code> and <code>yr</code>
in the function call, tailoring them to particular applications, and
making the code more resistant to changes in <code>sectionSmooth</code>.</p></dd>


<dt>df</dt>
<dd><p>Degree-of-freedom parameter, passed to <code><a href="https://rdrr.io/r/stats/smooth.spline.html" class="external-link">smooth.spline()</a></code>
if <code>method="spline"</code>, and ignored otherwise. If <code>df</code> is not provided,
it defaults to 1/5-th of the number of stations containing non-<code>NA</code>
data at the particular pressure level being processed, as <code>sectionSmooth</code>
works its way through the water column.</p></dd>


<dt>gamma, iterations, trim, pregrid</dt>
<dd><p>Values passed to
<code><a href="interpBarnes.html">interpBarnes()</a></code>, if <code>method="barnes"</code>, and
ignored otherwise. <code>gamma</code> is the factor by which
<code>xr</code> and <code>yr</code> are reduced on each of succeeding iterations.
<code>iterations</code> is the number of iterations to do.
<code>trim</code> controls whether the gridded data are set to
<code>NA</code> in regions with sparse data
coverage. <code>pregrid</code> controls whether data are to be
pre-gridded with <code><a href="binMean2D.html">binMean2D()</a></code> before being passed to
<code><a href="interpBarnes.html">interpBarnes()</a></code>.</p></dd>


<dt>debug</dt>
<dd><p>A flag that turns on debugging.  Set to 1 to get a moderate amount
of debugging information, or to 2 to get more.</p></dd>


<dt>...</dt>
<dd><p>Optional extra arguments, passed to either
<code><a href="https://rdrr.io/r/stats/smooth.spline.html" class="external-link">smooth.spline()</a></code>, if <code>method="spline"</code>, and ignored otherwise.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A <a href="section-class.html">section</a> object of that has been smoothed in some way.
Every data field that is in even a single station of the input object
is inserted into every station in the returned value, and therefore
the units represent all the units in any of the stations, as do the
flag names. However, the flags are all set to <code>NA</code> values.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function produces smoothed fields that might be useful in
simplifying graphical elements created with <code><a href="plot-section-method.html">plot,section-method()</a></code>.
As with any smoothing method, a careful analyst will compare the results
against the raw data, e.g. using <code><a href="plot-section-method.html">plot,section-method()</a></code>.
In addition the problem of falsely widening narrow features such as
fronts, there is also the potential to get unphysical results with
spars sampling near topographic features such as bottom slopes and ridges.</p>
<p>The <code>method</code> argument selects between three possible methods.</p><ul><li><p>For <code>method="spline"</code>, i.e. the default, the section is smoothed
laterally, using <code><a href="https://rdrr.io/r/stats/smooth.spline.html" class="external-link">smooth.spline()</a></code> on individual pressure levels.
(If the pressure levels do not match up, <code><a href="sectionGrid.html">sectionGrid()</a></code> should
be used first to create a <code>section</code> object that can be used here.)
The <code>df</code> argument sets the degree of freedom of the spline, with
larger values indicating less smoothing.</p></li>
<li><p>For <code>method="barnes"</code>, smoothing is done across
both horizontal and vertical coordinates, using <code><a href="interpBarnes.html">interpBarnes()</a></code>.
The output station locations are computed by linear interpolation of
input locations, using <code><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approx()</a></code> on the original
longitudes and longitudes of stations, with the independent variable
being the distance along the track, computed with <code><a href="geodDist.html">geodDist()</a></code>.
The values of <code>xg</code>, <code>yg</code>, <code>xgl</code> and <code>ygl</code> control
the smoothing.</p></li>
<li><p>For <code>method="kriging"</code>, smoothing is done across
both horizontal and vertical coordinates, using <code>autoKrige()</code> from
the <a href="https://CRAN.R-project.org/package=automap" class="external-link"><span class="pkg">automap</span></a> package (along with support from the
<a href="https://CRAN.R-project.org/package=sp" class="external-link"><span class="pkg">sp</span></a> package to format the data).  Note that the format of
the value returned by <code>autoKrige()</code> has changed over the years,
and <code>method="kriging"</code> can only handle two particular formats,
one of which is the result from version 1.1.9 of
<a href="https://CRAN.R-project.org/package=automap" class="external-link"><span class="pkg">automap</span></a>.</p></li>
<li><p>If <code>method</code> is a function, then that function is applied to
the (distance, pressure) data for each variable at a grid defined by
<code>xg</code>, <code>xgl</code>, <code>yg</code> and <code>ygl</code>. The function must
be of the form <code>function(x,y,z,xg,xr,yg,yr)</code>, and must
return a matrix of the gridded result, with first index indicating
the "grid" station number and second index indicating "grid" pressure.
The <code>x</code> value that is supplied to this function is set as
the distance along the section, as computed with <code><a href="geodDist.html">geodDist()</a></code>,
and repeated for each of the points at each station.  The corresponding
pressures are provided in <code>y</code>, and the value to be gridded is
in <code>z</code>, which may be <code>temperature</code> on one call to the function,
<code>salinity</code> on another call, etc. The other quantities
have the meanings as described below.</p></li>
</ul></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other things related to section data: 
<code><a href="sub-sub-section-method.html">[[,section-method</a></code>,
<code>[[&lt;-,section-method</code>,
<code><a href="as.section.html">as.section</a>()</code>,
<code><a href="handleFlags-section-method.html">handleFlags,section-method</a></code>,
<code><a href="initializeFlagScheme-section-method.html">initializeFlagScheme,section-method</a></code>,
<code><a href="plot-section-method.html">plot,section-method</a></code>,
<code><a href="read.section.html">read.section</a>()</code>,
<code><a href="section-class.html">section-class</a></code>,
<code><a href="sectionAddStation.html">sectionAddStation</a>()</code>,
<code><a href="sectionGrid.html">sectionGrid</a>()</code>,
<code><a href="sectionSort.html">sectionSort</a>()</code>,
<code><a href="section.html">section</a></code>,
<code><a href="subset-section-method.html">subset,section-method</a></code>,
<code><a href="summary-section-method.html">summary,section-method</a></code></p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Dan Kelley</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Unsmoothed (Gulf Stream)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/" class="external-link">oce</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">section</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">section</span>, <span class="fl">115</span><span class="op">&lt;=</span><span class="va">stationId</span><span class="op">&amp;</span><span class="va">stationId</span><span class="op">&lt;=</span><span class="fl">125</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gs</span>, which<span class="op">=</span><span class="st">"temperature"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="st">"Original data, without smoothing"</span>, line<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Spline</span></span></span>
<span class="r-in"><span><span class="va">gsg</span> <span class="op">&lt;-</span> <span class="fu"><a href="sectionGrid.html">sectionGrid</a></span><span class="op">(</span><span class="va">gs</span>, p<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5000</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gsSpline</span> <span class="op">&lt;-</span> <span class="fu">sectionSmooth</span><span class="op">(</span><span class="va">gsg</span>, <span class="st">"spline"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gsSpline</span>, which<span class="op">=</span><span class="st">"temperature"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="st">"sectionSmooth(..., method=\"spline\")"</span>, line<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Barnes</span></span></span>
<span class="r-in"><span><span class="va">gsBarnes</span> <span class="op">&lt;-</span> <span class="fu">sectionSmooth</span><span class="op">(</span><span class="va">gs</span>, <span class="st">"barnes"</span>, xr<span class="op">=</span><span class="fl">50</span>, yr<span class="op">=</span><span class="fl">200</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gsBarnes</span>, which<span class="op">=</span><span class="st">"temperature"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="st">"sectionSmooth(..., method=\"barnes\")"</span>, line<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Kriging. This is commented-out because one of the CRAN</span></span></span>
<span class="r-in"><span><span class="co"># check machines produces an error (converted from a warning)</span></span></span>
<span class="r-in"><span><span class="co"># and I am really not clear on whether dontrun will be</span></span></span>
<span class="r-in"><span><span class="co"># sufficient to solve the problem.</span></span></span>
<span class="r-in"><span><span class="co">#&gt; if (requireNamespace("automap", quietly=TRUE)</span></span></span>
<span class="r-in"><span><span class="co">#&gt;        &amp;&amp; requireNamespace("sf", quietly=TRUE)) {</span></span></span>
<span class="r-in"><span><span class="co">#&gt;     gsKriging &lt;- sectionSmooth(gs, "kriging", xr=50, yr=200)</span></span></span>
<span class="r-in"><span><span class="co">#&gt;     plot(gsKriging, which="temperature")</span></span></span>
<span class="r-in"><span><span class="co">#&gt;     mtext("sectionSmooth(..., method=\"kriging\")", line=0.5)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-plt img"><img src="sectionSmooth-1.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Dan Kelley, Clark Richards.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

