<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Lunar Angle as Function of Space and Time — moonAngle • oce</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Lunar Angle as Function of Space and Time — moonAngle"><meta name="description" content="The calculations are based on formulae provided by Meeus (1982), primarily
in chapters 6, 18, and 30.  The first step is to compute sidereal time as
formulated in Meeus (1982) chapter 7, which in turn uses Julian day computed
according to as formulae in Meeus (1982) chapter 3.  Using these quantities,
formulae in Meeus (1982) chapter 30 are then used to compute geocentric
longitude (\(lambda\), in the Meeus notation), geocentric latitude
(\(beta\)), and parallax.  Then the obliquity of the ecliptic
is computed with Meeus (1982) equation 18.4.  Equatorial coordinates (right
ascension and declination) are computed with equations 8.3 and 8.4 from
Meeus (1982), using eclipticalToEquatorial().  The hour angle
(\(H\)) is computed using the unnumbered equation preceding Meeus's
(1982) equation 8.1.  Finally, Meeus (1982) equations 8.5 and 8.6 are used
to calculate the local azimuth and altitude of the moon, using
equatorialToLocalHorizontal()."><meta property="og:description" content="The calculations are based on formulae provided by Meeus (1982), primarily
in chapters 6, 18, and 30.  The first step is to compute sidereal time as
formulated in Meeus (1982) chapter 7, which in turn uses Julian day computed
according to as formulae in Meeus (1982) chapter 3.  Using these quantities,
formulae in Meeus (1982) chapter 30 are then used to compute geocentric
longitude (\(lambda\), in the Meeus notation), geocentric latitude
(\(beta\)), and parallax.  Then the obliquity of the ecliptic
is computed with Meeus (1982) equation 18.4.  Equatorial coordinates (right
ascension and declination) are computed with equations 8.3 and 8.4 from
Meeus (1982), using eclipticalToEquatorial().  The hour angle
(\(H\)) is computed using the unnumbered equation preceding Meeus's
(1982) equation 8.1.  Finally, Meeus (1982) equations 8.5 and 8.6 are used
to calculate the local azimuth and altitude of the moon, using
equatorialToLocalHorizontal()."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">oce</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.8-4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/A_oce.html">1. Introduction to Oce</a></li>
    <li><a class="dropdown-item" href="../articles/B_ctd.html">2. Analysis of CTD data</a></li>
    <li><a class="dropdown-item" href="../articles/C_adp.html">3. Analysis of acoustic-Doppler data</a></li>
    <li><a class="dropdown-item" href="../articles/D_map_projections.html">4. Using map projections</a></li>
    <li><a class="dropdown-item" href="../articles/E_flags.html">5. Dealing with data-quality flags</a></li>
    <li><a class="dropdown-item" href="../articles/F_subclassing.html">6. Subclassing oce objects</a></li>
    <li><a class="dropdown-item" href="../articles/G_altering_defaults.html">7. Altering oce Defaults</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dankelley/oce/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Lunar Angle as Function of Space and Time</h1>
      <small class="dont-index">Source: <a href="https://github.com/dankelley/oce/blob/HEAD/R/moon.R" class="external-link"><code>R/moon.R</code></a></small>
      <div class="d-none name"><code>moonAngle.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The calculations are based on formulae provided by Meeus (1982), primarily
in chapters 6, 18, and 30.  The first step is to compute sidereal time as
formulated in Meeus (1982) chapter 7, which in turn uses Julian day computed
according to as formulae in Meeus (1982) chapter 3.  Using these quantities,
formulae in Meeus (1982) chapter 30 are then used to compute geocentric
longitude (\(lambda\), in the Meeus notation), geocentric latitude
(\(beta\)), and parallax.  Then the <code>obliquity</code> of the ecliptic
is computed with Meeus (1982) equation 18.4.  Equatorial coordinates (right
ascension and declination) are computed with equations 8.3 and 8.4 from
Meeus (1982), using <code><a href="eclipticalToEquatorial.html">eclipticalToEquatorial()</a></code>.  The hour angle
(\(H\)) is computed using the unnumbered equation preceding Meeus's
(1982) equation 8.1.  Finally, Meeus (1982) equations 8.5 and 8.6 are used
to calculate the local azimuth and altitude of the moon, using
<code><a href="equatorialToLocalHorizontal.html">equatorialToLocalHorizontal()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">moonAngle</span><span class="op">(</span><span class="va">t</span>, longitude <span class="op">=</span> <span class="fl">0</span>, latitude <span class="op">=</span> <span class="fl">0</span>, useRefraction <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-t">t<a class="anchor" aria-label="anchor" href="#arg-t"></a></dt>
<dd><p>time, a POSIXt object (converted to timezone <code>"UTC"</code>,
if it is not already in that timezone), a character or numeric value that
corresponds to such a time.</p></dd>


<dt id="arg-longitude">longitude<a class="anchor" aria-label="anchor" href="#arg-longitude"></a></dt>
<dd><p>observer longitude in degrees east</p></dd>


<dt id="arg-latitude">latitude<a class="anchor" aria-label="anchor" href="#arg-latitude"></a></dt>
<dd><p>observer latitude in degrees north</p></dd>


<dt id="arg-userefraction">useRefraction<a class="anchor" aria-label="anchor" href="#arg-userefraction"></a></dt>
<dd><p>boolean, set to <code>TRUE</code> to apply a correction for
atmospheric refraction.  (Ignored at present.)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing the following.</p><ul><li><p><code>time</code></p></li>
<li><p><code>azimuth</code> moon azimuth, in degrees eastward of north, from 0 to 360.
Note: this is not the convention used by Meeus, who uses degrees westward of
South. Here, the convention is chosen to more closely match the expectation
of oceanographers.</p></li>
<li><p><code>altitude</code> moon altitude, in degrees from -90 to 90.</p></li>
<li><p><code>rightAscension</code> in' degrees.</p></li>
<li><p><code>declination</code> in degrees.</p></li>
<li><p><code>lambda</code> geocentric longitude, in degrees.</p></li>
<li><p><code>beta</code> geocentric latitude, in degrees.</p></li>
<li><p><code>diameter</code> lunar diameter, in degrees.</p></li>
<li><p><code>distance</code> earth-moon distance, in kilometers.</p></li>
<li><p><code>illuminatedFraction</code> fraction of moon's visible disk that is illuminated.</p></li>
<li><p><code>phase</code> phase of the moon, defined in equation 32.3 of Meeus (1982).
The fractional part of which is 0 for new moon, 1/4 for first
quarter, 1/2 for full moon, and 3/4 for last quarter.</p></li>
</ul><p><img src="figures/starCoords.png" width="400"></p>
    </div>
    <div class="section level2">
    <h2 id="alternate-formulations">Alternate formulations<a class="anchor" aria-label="anchor" href="#alternate-formulations"></a></h2>


<p>Formulae provide by Meeus (1982) are used
for all calculations here.  Meeus (1991) provides formulae that are similar,
but that differ in the 5th or 6th digits.  For example, the formula for
ephemeris time in Meeus (1991) differs from that in Meeus (1992) at the 5th
digit, and almost all of the approximately 200 coefficients in the relevant
formulae also differ in the 5th and 6th digits.  Discussion of the changing
formulations is best left to members of the astronomical community.  For the
present purpose, it may be sufficient to note that <code>moonAngle</code>, based
on Meeus (1982), reproduces the values provided in example 45.a of Meeus
(1991) to 4 significant digits, e.g. with all angles matching to under 2
minutes of arc.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<ul><li><p>Meeus, Jean. Astronomical Formulas for Calculators. Second Edition.
Richmond, Virginia, USA: Willmann-Bell, 1982.</p></li>
<li><p>Meeus, Jean. Astronomical Algorithms. Second Edition.
Richmond, Virginia, USA: Willmann-Bell, 1991.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>The equivalent function for the sun is <code><a href="sunAngle.html">sunAngle()</a></code>.</p>
<p>Other things related to astronomy:
<code><a href="angle2hms.html">angle2hms</a>()</code>,
<code><a href="eclipticalToEquatorial.html">eclipticalToEquatorial</a>()</code>,
<code><a href="equatorialToLocalHorizontal.html">equatorialToLocalHorizontal</a>()</code>,
<code><a href="julianCenturyAnomaly.html">julianCenturyAnomaly</a>()</code>,
<code><a href="julianDay.html">julianDay</a>()</code>,
<code><a href="siderealTime.html">siderealTime</a>()</code>,
<code><a href="sunAngle.html">sunAngle</a>()</code>,
<code><a href="sunDeclinationRightAscension.html">sunDeclinationRightAscension</a>()</code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Dan Kelley, based on formulae in Meeus (1982).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/">oce</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">2012</span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">4</span></span></span>
<span class="r-in"><span><span class="va">days</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span></span></span>
<span class="r-in"><span><span class="co"># Halifax sunrise/sunset (see e.g. https://www.timeanddate.com/worldclock)</span></span></span>
<span class="r-in"><span><span class="va">rises</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html" class="external-link">ISOdatetime</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">m</span>, <span class="va">days</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>, <span class="fl">15</span>, <span class="fl">16</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">55</span>, <span class="fl">04</span>, <span class="fl">16</span><span class="op">)</span>, <span class="fl">0</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span> <span class="op">+</span> <span class="fl">3</span> <span class="op">*</span> <span class="fl">3600</span> <span class="co"># ADT</span></span></span>
<span class="r-in"><span><span class="va">sets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html" class="external-link">ISOdatetime</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">m</span>, <span class="va">days</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">42</span>, <span class="fl">15</span>, <span class="fl">45</span><span class="op">)</span>, <span class="fl">0</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span> <span class="op">+</span> <span class="fl">3</span> <span class="op">*</span> <span class="fl">3600</span></span></span>
<span class="r-in"><span><span class="va">azrises</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">69</span>, <span class="fl">75</span>, <span class="fl">82</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">azsets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">293</span>, <span class="fl">288</span>, <span class="fl">281</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">latitude</span> <span class="op">&lt;-</span> <span class="fl">44.65</span></span></span>
<span class="r-in"><span><span class="va">longitude</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">63.6</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html" class="external-link">ISOdatetime</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">m</span>, <span class="va">days</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span>, <span class="fl">3600</span> <span class="op">/</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">ma</span> <span class="op">&lt;-</span> <span class="fu">moonAngle</span><span class="op">(</span><span class="va">t</span>, <span class="va">longitude</span>, <span class="va">latitude</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="oce.plot.ts.html">oce.plot.ts</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">ma</span><span class="op">$</span><span class="va">altitude</span>, type <span class="op">=</span> <span class="st">"l"</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">2</span>, ylab <span class="op">=</span> <span class="st">"Altitude"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">rises</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">3</span>, lwd <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">sets</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"blue"</span>, pch <span class="op">=</span> <span class="fl">3</span>, lwd <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="oce.plot.ts.html">oce.plot.ts</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">ma</span><span class="op">$</span><span class="va">azimuth</span>, type <span class="op">=</span> <span class="st">"l"</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">2</span>, ylab <span class="op">=</span> <span class="st">"Azimuth"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">rises</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="op">-</span><span class="fl">180</span> <span class="op">+</span> <span class="va">azrises</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">3</span>, lwd <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">sets</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="op">-</span><span class="fl">180</span> <span class="op">+</span> <span class="va">azsets</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"blue"</span>, pch <span class="op">=</span> <span class="fl">3</span>, lwd <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="moonAngle-1.png" alt="" width="700" height="700"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dan Kelley, Clark Richards.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

