<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Trim Beginning and Ending of a CTD cast — ctdTrim • oce</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Trim Beginning and Ending of a CTD cast — ctdTrim" />
<meta property="og:description" content="Often in CTD profiling, the goal is to isolate only the downcast, discarding measurements made in
the air, in an equilibration phase in which the device is held below the water surface, and then the
upcast phase that follows the downcast.  This is handled reasonably well by ctdTrim with
method=&quot;downcast&quot;, although it is almost always best to use plotScan() to
investigate the data, and then use the method=&quot;index&quot; or method=&quot;scan&quot; method based on
visual inspection of the data." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">oce</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2-1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/oce.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/adp.html">3. Analysis of acoustic-Doppler data</a>
    </li>
    <li>
      <a href="../articles/ctd.html">2. Analysis of CTD data</a>
    </li>
    <li>
      <a href="../articles/flags.html">5. Dealing with data-quality flags</a>
    </li>
    <li>
      <a href="../articles/map_projections.html">4. Using map projections</a>
    </li>
    <li>
      <a href="../articles/subclassing.html">6. Subclassing oce objects</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/dankelley/oce/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Trim Beginning and Ending of a CTD cast</h1>
    <small class="dont-index">Source: <a href='https://github.com/dankelley/oce/blob/master/R/ctd.R'><code>R/ctd.R</code></a></small>
    <div class="hidden name"><code>ctdTrim.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Often in CTD profiling, the goal is to isolate only the downcast, discarding measurements made in
the air, in an equilibration phase in which the device is held below the water surface, and then the
upcast phase that follows the downcast.  This is handled reasonably well by <code>ctdTrim</code> with
<code>method="downcast"</code>, although it is almost always best to use <code><a href='plotScan.html'>plotScan()</a></code> to
investigate the data, and then use the <code>method="index"</code> or <code>method="scan"</code> method based on
visual inspection of the data.</p>
    </div>

    <pre class="usage"><span class='fu'>ctdTrim</span>(
  <span class='no'>x</span>,
  <span class='no'>method</span>,
  <span class='kw'>removeDepthInversions</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>parameters</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>indices</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>debug</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span>(<span class='st'>"oceDebug"</span>)
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>a <a href='ctd-class.html'>ctd</a> object.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>A string (or a vector of two strings) specifying the trimming method, or a function to
be used to determine data indices to keep.  If <code>method</code> is not provided, <code>"downcast"</code> is
assumed. See &#8220;Details&#8221;.</p></td>
    </tr>
    <tr>
      <th>removeDepthInversions</th>
      <td><p>Logical value indicating whether to remove any levels at which depth is
less than, or equal to, a depth above.  (This is needed if the object is to be assembled into a
section, unless <code><a href='ctdDecimate.html'>ctdDecimate()</a></code> will be used, which will remove the inversions.</p></td>
    </tr>
    <tr>
      <th>parameters</th>
      <td><p>A list whose elements depend on the method; see &#8220;Details&#8221;.</p></td>
    </tr>
    <tr>
      <th>indices</th>
      <td><p>Logical value indicating what to return. If <code>indices=FALSE</code> (the default),
then the return value is a subsetted <a href='ctd-class.html'>ctd</a> object. If <code>indices=TRUE</code>,
then the return value is a logical vector that could be used to subset the data
with <code><a href='subset-ctd-method.html'>subset,ctd-method()</a></code> or to set data-quality flags.</p></td>
    </tr>
    <tr>
      <th>debug</th>
      <td><p>an integer specifying whether debugging information is
to be printed during the processing. This is a general parameter that
is used by many <code>oce</code> functions. Generally, setting <code>debug=0</code>
turns off the printing, while higher values suggest that more information
be printed. If one function calls another, it usually reduces the value of
<code>debug</code> first, so that a user can often obtain deeper debugging
by specifying higher <code>debug</code> values.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Either a <a href='ctd-class.html'>ctd</a> object of or a logical vector of length
matching the data. The first option is the default. The second option,
achieved by setting <code>indices=FALSE</code>, may be useful in constructing
data flags to be inserted into the object.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>ctdTrim</code> begins by examining the pressure differences between subsequent samples. If
these are all of the same value, then the input <code>ctd</code> object is returned, unaltered.
This handles the case of pressure-binned data. However, if the pressure difference
varies, a variety of approaches are taken to trimming the dataset.</p><ul>
<li><p>If <code>method[1]</code> is <code>"downcast"</code> then an attempt is made to keep only data for
which the CTD is descending.  This is done in stages, with variants based on <code>method[2]</code>, if
supplied.</p><ol>
<li><p>The pressure data are despiked with a smooth() filter with method "3R".
This removes wild spikes that arise from poor instrument connections, etc.</p></li>
<li><p><em>Step 2.</em> If no <code>parameters</code> are given, then any data with negative pressures
are deleted.  If there is a parameter named <code>pmin</code>, then that pressure (in decibars)
is used instead as the lower limit. This is a commonly-used setup, e.g.
<code>ctdTrim(ctd, parameters=list(pmin=1))</code> removes the top decibar (roughly 1m) from
the data.  Specifying <code>pmin</code> is a simple way to remove near-surface
data, such as a shallow equilibration phase, and if specified will cause <code>ctdTrim</code>
to skip step 4 below.</p></li>
<li><p>The maximum pressure is determined, and data acquired subsequent to
that point are deleted.  This removes the upcast and any subsequent data.</p></li>
<li><p>If the <code>pmin</code> parameter is not specified, an attempt is made to remove an initial
equilibrium phase by a regression of pressure on scan number.  There are three
variants to this, depending on the value of the second <code>method</code> element.
If <code>method</code> is <code>"A"</code> (or not given), the procedure is to
call <code><a href='https://rdrr.io/r/stats/nls.html'>nls()</a></code> to fit a piecewise linear model of pressure as a function of scan,
in which pressure is constant for scan less than a critical value, and then
linearly varying for with scan. This is  meant to handle the common situation
in which the CTD is held at roughly constant depth (typically
a metre or so) to equilibrate, before it is lowered through the water column.
If <code>method</code> is <code>"B"</code>, the procedure is similar, except that the pressure
in the surface region is taken to be zero (this does not make
much sense, but it might help in some cases). Note that, prior to early 2016,
method <code>"B"</code> was called method <code>"C"</code>; the old <code>"B"</code> method was judged useless
and so it was removed.</p></li>
</ol></li>
<li><p>If <code>method="upcast"</code>, a sort of reverse of <code>"downcast"</code> is used. This
was added in late April 2017 and has not been well tested yet.</p></li>
<li><p>If <code>method="sbe"</code>, a method similar to that described
in the SBE Data Processing manual is used to remove the "soak"
period at the beginning of a cast (see Section 6 under subsection
"Loop Edit"). The method is based on the soak procedure whereby
the instrument sits at a fixed depth for a period of time, after
which it is raised toward the surface before beginning the actual
downcast. This enables equilibration of the sensors while still
permitting reasonably good near-surface data. Parameters for the
method can be passed using the <code>parameters</code> argument, which
include <code>minSoak</code> (the minimum depth for the soak) and
<code>maxSoak</code> the maximum depth of the soak. The method finds
the minimum pressure prior to the <code>maxSoak</code> value being
passed, each of which occurring after the scan in which the
<code>minSoak</code> value was reached. For the method to work, the
pre-cast pressure minimum must be less than the <code>minSoak</code>
value. The default values of <code>minSoak</code> and <code>maxSoak</code>
are 1 and 20 dbar, respectively.</p></li>
<li><p>If <code>method="index"</code> or <code>"scan"</code>, then each column of data is subsetted according to the
value of <code>parameters</code>. If the latter is a logical vector of length matching data column
length, then it is used directly for subsetting. If <code>parameters</code> is a numerical vector with
two elements, then the index or scan values that lie between <code>parameters[1]</code>
and <code>parameters[2]</code> (inclusive) are used for subsetting.  The
two-element method is probably the most useful, with the values being determined by visual
inspection of the results of <code><a href='plotScan.html'>plotScan()</a></code>. While this may take a minute or two, the
analyst should bear in mind that a deep-water CTD profile might take 6 hours, corresponding to
ship-time costs exceeding a week of salary.</p></li>
<li><p>If <code>method="range"</code> then data are selected based on the value of the column named
<code>parameters$item</code>.  This may be by range or by critical value.  By range: select values
between <code>parameters$from</code> (the lower limit) and <code>parameters$to</code> (the upper limit) By
critical value: select if the named column exceeds the value.  For example, <code>ctd2 &lt;-
    ctdTrim(ctd, "range", parameters=list(item="scan", from=5))</code> starts at scan number 5 and
continues to the end, while
<code>ctdTrim(ctd,"range",parameters=list(item="scan",from=5,to=100))</code> also starts at scan 5,
but extends only to scan 100.</p></li>
<li><p>If <code>method</code> is a function, then it must return a vector of <code><a href='https://rdrr.io/r/base/logical.html'>logical()</a></code>
values, computed based on two arguments: <code>data</code> (a
<code><a href='https://rdrr.io/r/base/list.html'>list()</a></code>), and <code>parameters</code> as supplied to <code>ctdTrim</code>.  Both
<code>inferWaterDepth</code> and <code>removeInversions</code> are ignored in the function case. See
&#8220;Examples&#8221;.</p></li>
</ul>

    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>The Seabird CTD instrument is described at
<code>http://www.seabird.com/products/spec_sheets/19plusdata.htm</code>.</p>
<p>Seasoft V2: SBE Data Processing, SeaBird Scientific, 05/26/2016</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other things related to ctd data: 
<code><a href='CTD_BCD2014666_008_1_DN.ODF.gz.html'>CTD_BCD2014666_008_1_DN.ODF.gz</a></code>,
<code><a href='sub-sub-ctd-method.html'>[[,ctd-method</a></code>,
<code>[[&lt;-,ctd-method</code>,
<code><a href='as.ctd.html'>as.ctd</a>()</code>,
<code><a href='cnvName2oceName.html'>cnvName2oceName</a>()</code>,
<code><a href='ctd-class.html'>ctd-class</a></code>,
<code><a href='ctd.cnv.html'>ctd.cnv</a></code>,
<code><a href='ctdDecimate.html'>ctdDecimate</a>()</code>,
<code><a href='ctdFindProfiles.html'>ctdFindProfiles</a>()</code>,
<code><a href='ctdRaw.html'>ctdRaw</a></code>,
<code><a href='ctd.html'>ctd</a></code>,
<code><a href='d200321-001.ctd.html'>d200321-001.ctd</a></code>,
<code><a href='d201211_0011.cnv.html'>d201211_0011.cnv</a></code>,
<code><a href='handleFlags-ctd-method.html'>handleFlags,ctd-method</a></code>,
<code><a href='initialize-ctd-method.html'>initialize,ctd-method</a></code>,
<code><a href='initializeFlagScheme-ctd-method.html'>initializeFlagScheme,ctd-method</a></code>,
<code><a href='oceNames2whpNames.html'>oceNames2whpNames</a>()</code>,
<code><a href='oceUnits2whpUnits.html'>oceUnits2whpUnits</a>()</code>,
<code><a href='plot-ctd-method.html'>plot,ctd-method</a></code>,
<code><a href='plotProfile.html'>plotProfile</a>()</code>,
<code><a href='plotScan.html'>plotScan</a>()</code>,
<code><a href='plotTS.html'>plotTS</a>()</code>,
<code><a href='read.ctd.itp.html'>read.ctd.itp</a>()</code>,
<code><a href='read.ctd.odf.html'>read.ctd.odf</a>()</code>,
<code><a href='read.ctd.odv.html'>read.ctd.odv</a>()</code>,
<code><a href='read.ctd.sbe.html'>read.ctd.sbe</a>()</code>,
<code><a href='read.ctd.woce.other.html'>read.ctd.woce.other</a>()</code>,
<code><a href='read.ctd.woce.html'>read.ctd.woce</a>()</code>,
<code><a href='read.ctd.html'>read.ctd</a>()</code>,
<code><a href='setFlags-ctd-method.html'>setFlags,ctd-method</a></code>,
<code><a href='subset-ctd-method.html'>subset,ctd-method</a></code>,
<code><a href='summary-ctd-method.html'>summary,ctd-method</a></code>,
<code><a href='woceNames2oceNames.html'>woceNames2oceNames</a>()</code>,
<code><a href='woceUnit2oceUnit.html'>woceUnit2oceUnit</a>()</code>,
<code><a href='write.ctd.html'>write.ctd</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>oce</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>ctdRaw</span>)
<span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>ctdRaw</span>) <span class='co'># barely recognizable, due to pre- and post-cast junk</span>
<span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='fu'>ctdTrim</span>(<span class='no'>ctdRaw</span>)) <span class='co'># looks like a real profile ...</span>
<span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='fu'><a href='ctdDecimate.html'>ctdDecimate</a></span>(<span class='fu'>ctdTrim</span>(<span class='no'>ctdRaw</span>),<span class='kw'>method</span><span class='kw'>=</span><span class='st'>"boxcar"</span>)) <span class='co'># ... smoothed</span>
<span class='co'># Demonstrate use of a function. The scan limits were chosen</span>
<span class='co'># by using locator(2) on a graph made by plotScan(ctdRaw).</span>
<span class='no'>trimByIndex</span><span class='kw'>&lt;-</span><span class='kw'>function</span>(<span class='no'>data</span>, <span class='no'>parameters</span>) {
  <span class='no'>parameters</span>[<span class='fl'>1</span>] <span class='kw'>&lt;</span> <span class='no'>data</span>$<span class='no'>scan</span> <span class='kw'>&amp;</span> <span class='no'>data</span>$<span class='no'>scan</span> <span class='kw'>&lt;</span> <span class='no'>parameters</span>[<span class='fl'>2</span>]
}
<span class='no'>trimmed</span> <span class='kw'>&lt;-</span> <span class='fu'>ctdTrim</span>(<span class='no'>ctdRaw</span>, <span class='no'>trimByIndex</span>, <span class='kw'>parameters</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>130</span>, <span class='fl'>380</span>))
<span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>trimmed</span>)
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Dan Kelley, Clark Richards.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


