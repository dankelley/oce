<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Convert an ADP from XYZ to ENU Coordinates — xyzToEnuAdv • oce</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Convert an ADP from XYZ to ENU Coordinates — xyzToEnuAdv"><meta property="og:description" content="Convert ADV velocity components from a xyz-based coordinate system to
an enu-based coordinate system."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">oce</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.8-2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/A_oce.html">1. Introduction to Oce</a>
    </li>
    <li>
      <a href="../articles/B_ctd.html">2. Analysis of CTD data</a>
    </li>
    <li>
      <a href="../articles/C_adp.html">3. Analysis of acoustic-Doppler data</a>
    </li>
    <li>
      <a href="../articles/D_map_projections.html">4. Using map projections</a>
    </li>
    <li>
      <a href="../articles/E_flags.html">5. Dealing with data-quality flags</a>
    </li>
    <li>
      <a href="../articles/F_subclassing.html">6. Subclassing oce objects</a>
    </li>
    <li>
      <a href="../articles/G_altering_defaults.html">7. Altering oce Defaults</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/dankelley/oce/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Convert an ADP from XYZ to ENU Coordinates</h1>
    <small class="dont-index">Source: <a href="https://github.com/dankelley/oce/blob/HEAD/R/adv.R" class="external-link"><code>R/adv.R</code></a></small>
    <div class="hidden name"><code>xyzToEnuAdv.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Convert ADV velocity components from a xyz-based coordinate system to
an enu-based coordinate system.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">xyzToEnuAdv</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  declination <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  cabled <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">horizontalCase</span>,</span>
<span>  <span class="va">sensorOrientation</span>,</span>
<span>  debug <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"oceDebug"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>an <a href="adv-class.html">adv</a> object.</p></dd>


<dt>declination</dt>
<dd><p>magnetic declination to be added to the heading after
"righting" (see below), to get ENU with N as "true" north.  If this
is set to NULL, then the returned object is set up without adjusting
the compass for declination.  That means that <code>north</code> in its <code>metadata</code>
slot will be set to <code>"magnetic"</code>, and also that there will be no item
named <code>declination</code> in that slot.  Note that <code><a href="applyMagneticDeclination.html">applyMagneticDeclination()</a></code>
can be used later, to set a declination.</p></dd>


<dt>cabled</dt>
<dd><p>boolean value indicating whether the sensor head is connected
to the pressure case with a cable.  If <code>cabled=FALSE</code>, then
<code>horizontalCase</code> is ignored.  See “Details”.</p></dd>


<dt>horizontalCase</dt>
<dd><p>optional boolean value indicating whether the sensor
case is oriented horizontally.  Ignored unless <code>cabled</code> is <code>TRUE</code>.
See “Details”.</p></dd>


<dt>sensorOrientation</dt>
<dd><p>optional string indicating the direction in which
the sensor points.  The value, which must be <code>"upward"</code> or
<code>"downward"</code>, over-rides the value of <code>orientation</code>,
in the <code>metadata</code> slot,
which will have been set by <code><a href="read.adv.html">read.adv()</a></code>, <em>provided</em> that the
data file contained the full header.  See “Details”.</p></dd>


<dt>debug</dt>
<dd><p>a flag that, if non-zero, turns on debugging.  Higher values
yield more extensive debugging.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>The coordinate transformation is done using the heading, pitch, and roll
information contained within <code>x</code>.  The algorithm is similar to that
used for Teledyne/RDI ADCP units, taking into account the different
definitions of heading, pitch, and roll as they are defined for the
velocimeters.</p>
<p>Generally, the transformation must be done on a time-by-time basis, which is
a slow operation.  However, this function checks whether the vectors for
heading, pitch and roll, are all of unit length, and in that case, the
calculation is altered, resulting in shorter execution times.  Note that
the angles are held in (<code>data$timeSlow</code>, <code>data$headingSlow</code>, ...)
for Nortek instruments and (<code>data$time</code>, <code>data$heading</code>, ...) for
Sontek instruments.</p>
<p>Since the documentation provided by instrument manufacturers can be vague on
the coordinate transformations, the method used here had to be developed
indirectly.  (This is in contrast to the RDI ADCP instruments, for which
there are clear instructions.)  documents that manufacturers provide.  If
results seem incorrect (e.g. if currents go east instead of west), users
should examine the code in detail for the case at hand.  The first step is
to set <code>debug</code> to 1, so that the processing will print a trail of
processing steps.  The next step should be to consult the table below, to
see if it matches the understanding (or empirical tests) of the user.  It
should not be difficult to tailor the code, if needed.</p>
<p>The code handles every case individually, based on the table given below.
The table comes from Clark Richards, a former PhD student at Dalhousie
University (reference 2), who developed it based on instrument documentation,
discussion on user groups, and analysis of measurements acquired with Nortek
and Sontek velocimeters in the SLEIWEX experiment.</p>
<p>The column labelled <code>Cabled'' indicates whether the sensor and the pressure case are connected with a flexible cable, and the column labelled </code>H.case''
indicates whether the pressure case is oriented horizontally.  These two
properties are not discoverable in the headers of the data files, and so
they must be supplied with the arguments <code>cabled</code> and
<code>horizontalCase</code>.  The source code refers to the information in this
table by case numbers.  (Cases 5 and 6 are not handled.)  Angles are
abbreviated as follows:: heading <code>H,'' pitch </code>P,'' and roll ``R''.
Entries X, Y and Z refer to instrument coordinates of the same names.
Entries S, F and M refer to so-called ship coordinates starboard, forward,
and mast; it is these that are used together with a rotation matrix to get
velocity components in the east, north, and upward directions.</p>
<table class="table table"><tr><td><strong><code>Case</code></strong></td><td><strong><code>Mfr.</code></strong></td><td><strong><code>Instr.</code></strong></td><td><strong><code>Cabled</code></strong></td><td><strong><code>H. case</code></strong></td><td><strong><code>Orient.</code></strong></td><td><strong><code>H</code></strong></td><td><strong><code>P</code></strong></td><td><strong><code>R</code></strong></td><td><strong><code>S</code></strong></td><td><strong><code>F</code></strong></td><td><strong><code>M</code></strong></td></tr><tr><td>1</td><td>Nortek</td><td>vector</td><td>no</td><td>-</td><td>up</td><td>H-90</td><td>R</td><td>-P</td><td>X</td><td>-Y</td><td>-Z</td></tr><tr><td>2</td><td>Nortek</td><td>vector</td><td>no</td><td>-</td><td>down</td><td>H-90</td><td>R</td><td>-P</td><td>X</td><td>Y</td><td>Z</td></tr><tr><td>3</td><td>Nortek</td><td>vector</td><td>yes</td><td>yes</td><td>up</td><td>H-90</td><td>R</td><td>-P</td><td>X</td><td>Y</td><td>Z</td></tr><tr><td>4</td><td>Nortek</td><td>vector</td><td>yes</td><td>yes</td><td>down</td><td>H-90</td><td>R</td><td>P</td><td>X</td><td>-Y</td><td>-Z</td></tr><tr><td>5</td><td>Nortek</td><td>vector</td><td>yes</td><td>no</td><td>up</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td></tr><tr><td>6</td><td>Nortek</td><td>vector</td><td>yes</td><td>no</td><td>down</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td></tr><tr><td>7</td><td>Sontek</td><td>adv</td><td>-</td><td>-</td><td>up</td><td>H-90</td><td>R</td><td>-P</td><td>X</td><td>-Y</td><td>-Z</td></tr><tr><td>8</td><td>Sontek</td><td>adv</td><td>-</td><td>-</td><td>down</td><td>H-90</td><td>R</td><td>-P</td><td>X</td><td>Y</td><td>Z</td></tr></table></div>
    <div id="references">
    <h2>References</h2>
    
<ol><li><p><code>https://nortek.zendesk.com/hc/en-us/articles/360029820971-How-is-a-Coordinate-transformation-done-</code></p></li>
<li><p>Clark Richards, 2012, PhD Dalhousie University Department of
Oceanography.</p></li>
</ol></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>See <code><a href="read.adv.html">read.adv()</a></code> for notes on functions relating to
<code>adv</code> objects.</p>
<p>Other things related to adv data: 
<code><a href="sub-sub-adv-method.html">[[,adv-method</a></code>,
<code>[[&lt;-,adv-method</code>,
<code><a href="adv-class.html">adv-class</a></code>,
<code><a href="advSontekAdrFileTrim.html">advSontekAdrFileTrim</a>()</code>,
<code><a href="adv.html">adv</a></code>,
<code><a href="applyMagneticDeclination-adv-method.html">applyMagneticDeclination,adv-method</a></code>,
<code><a href="beamName.html">beamName</a>()</code>,
<code><a href="beamToXyz.html">beamToXyz</a>()</code>,
<code><a href="enuToOtherAdv.html">enuToOtherAdv</a>()</code>,
<code><a href="enuToOther.html">enuToOther</a>()</code>,
<code><a href="plot-adv-method.html">plot,adv-method</a></code>,
<code><a href="read.adv.nortek.html">read.adv.nortek</a>()</code>,
<code><a href="read.adv.sontek.adr.html">read.adv.sontek.adr</a>()</code>,
<code><a href="read.adv.sontek.serial.html">read.adv.sontek.serial</a>()</code>,
<code><a href="read.adv.sontek.text.html">read.adv.sontek.text</a>()</code>,
<code><a href="read.adv.html">read.adv</a>()</code>,
<code><a href="rotateAboutZ.html">rotateAboutZ</a>()</code>,
<code><a href="subset-adv-method.html">subset,adv-method</a></code>,
<code><a href="summary-adv-method.html">summary,adv-method</a></code>,
<code><a href="toEnuAdv.html">toEnuAdv</a>()</code>,
<code><a href="toEnu.html">toEnu</a>()</code>,
<code><a href="velocityStatistics.html">velocityStatistics</a>()</code>,
<code><a href="xyzToEnu.html">xyzToEnu</a>()</code></p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Dan Kelley, in collaboration with Clark Richards</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Dan Kelley, Clark Richards.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

